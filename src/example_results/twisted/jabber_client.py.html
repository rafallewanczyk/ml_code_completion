<!DOCTYPE html>
<html>
<head>
<style>
span.c {
    background-color: #CCFFCC;
}
span.pc {
    background-color: #FFEEBB;
}
span.w {
    background-color: #FFCCCC;
}
</style>
</head>
<body>
<pre>








<span class="w">from</span> <span class="w">twisted.words.protocols.jabber</span> <span class="w">import</span> <span class="w">client,</span> <span class="w">jid</span>
<span class="w">from</span> <span class="w">twisted.words.xish</span> <span class="w">import</span> <span class="w">domish</span>
<span class="w">from</span> <span class="w">twisted.internet</span> <span class="w">import</span> <span class="w">reactor</span>
        
<span class="w">def</span> <span class="w">authd(xmlstream):</span>
    <span class="w">print</span> <span class="w">"authenticated"</span>

    <span class="w">presence</span> <span class="w">=</span> <span class="w">domish.Element((</span><span class="pc">'</span><span class="w">j</span><span class="c">abber:</span><span class="w">c</span><span class="c">lient</span><span class="w">','</span><span class="c">presence</span><span class="w">')</span><span class="pc">)</span>
    <span class="w">x</span><span class="pc">m</span><span class="c">lstream.</span><span class="w">s</span><span class="pc">en</span><span class="c">d(presence)</span>
    
    <span class="w">x</span><span class="pc">m</span><span class="c">lstream.</span><span class="w">ad</span><span class="pc">dO</span><span class="c">bserver</span><span class="w">('/me</span><span class="c">ssage</span><span class="w">'</span><span class="pc">,</span>  <span class="w">de</span><span class="pc">b</span><span class="c">ug)</span>
    <span class="w">x</span><span class="pc">m</span><span class="c">lstream.</span><span class="w">ad</span><span class="pc">dO</span><span class="c">bserver</span><span class="w">('</span><span class="pc">/</span><span class="c">presence</span><span class="w">'</span><span class="pc">,</span> <span class="w">de</span><span class="pc">b</span><span class="c">ug</span><span class="pc">)</span>
    <span class="w">x</span><span class="pc">m</span><span class="c">lstream.</span><span class="w">ad</span><span class="pc">dO</span><span class="c">bserver</span><span class="w">('</span><span class="pc">/</span><span class="w">i</span><span class="pc">q</span><span class="w">'</span><span class="c">,</span>       <span class="w">de</span><span class="pc">b</span><span class="c">ug)</span>   

<span class="pc">d</span><span class="c">ef</span> <span class="w">de</span><span class="pc">b</span><span class="c">ug(</span><span class="w">el</span><span class="pc">em</span><span class="c">):</span>
    <span class="pc">p</span><span class="c">rint</span> <span class="w">el</span><span class="pc">em</span><span class="c">.</span><span class="w">toXml</span><span class="pc">().</span><span class="w">e</span><span class="pc">n</span><span class="c">code('utf-8</span><span class="pc">')</span>
    <span class="w">p</span><span class="c">rint</span> <span class="w">"="*2</span><span class="pc">0</span>
    
<span class="w">myJid</span> <span class="w">=</span> <span class="w">j</span><span class="pc">i</span><span class="c">d.</span><span class="w">JID</span><span class="pc">('</span><span class="w">u</span><span class="c">sername</span><span class="w">@s</span><span class="pc">er</span><span class="c">ver.</span><span class="w">j</span><span class="c">abber</span><span class="pc">/</span><span class="w">twisted_words</span><span class="pc">')</span>
<span class="w">fa</span><span class="c">ctory</span> <span class="c">=</span> <span class="w">c</span><span class="pc">l</span><span class="c">ient.</span><span class="w">basicClientFactory</span><span class="c">(</span><span class="w">m</span><span class="c">yJid</span><span class="w">,</span><span class="pc"> </span><span class="c">'</span><span class="pc">p</span><span class="c">assword')</span>
<span class="w">f</span><span class="pc">a</span><span class="c">ctory.</span><span class="w">addBootstrap('//ev</span><span class="c">ent</span><span class="w">/st</span><span class="c">ream</span><span class="pc">/</span><span class="w">authd'</span><span class="pc">,</span><span class="w">a</span><span class="pc">u</span><span class="c">thd)</span>
<span class="w">r</span><span class="pc">ea</span><span class="c">ctor.</span><span class="w">c</span><span class="pc">o</span><span class="c">nnectTCP('</span><span class="w">s</span><span class="pc">e</span><span class="c">rver</span><span class="pc">.</span><span class="w">j</span><span class="c">abber</span><span class="pc">'</span><span class="c">,</span><span class="w">5222,f</span><span class="pc">a</span><span class="c">ctory)</span>
<span class="pc">r</span><span class="c">eactor.run()</span>

</pre>
</body>
</html>

