<!DOCTYPE html>
<html>
<head>
<style>
span.c {
    background-color: #CCFFCC;
}
span.pc {
    background-color: #FFEEBB;
}
span.w {
    background-color: #FFCCCC;
}
</style>
</head>
<body>
<pre>


<span class="w">#include</span> <span class="w">&lt;linux/device.h&gt;</span>
<span class="w">#include</span> <span class="w">&lt;linux/export.h&gt;</span>
<span class="w">#include</span> <span class="w">&lt;linux/platform_device.h&gt;</span>
<span class="w">#include</span> <span class="w">&lt;linux/mtd/mtd.h&gt;</span>
<span class="w">#include</span> <span class="c">&lt;linux/mtd/</span><span class="w">partitions</span><span class="c">.h&gt;</span>
<span class="c">#include</span> <span class="c">&lt;linux/mtd/</span><span class="w">physmap</span><span class="c">.h&gt;</span>
<span class="c">#include</span> <span class="c">&lt;linux/</span><span class="w">s</span><span class="pc">p</span><span class="c">i/spi.h&gt;</span>
<span class="c">#include</span> <span class="c">&lt;linux/</span><span class="pc">sp</span><span class="c">i/</span><span class="w">fl</span><span class="c">ash.h&gt;</span>
<span class="c">#include</span> <span class="c">&lt;linux/</span><span class="w">i2</span><span class="c">c</span><span class="pc">.</span><span class="c">h&gt;</span>
<span class="c">#include</span> <span class="c">&lt;linux/</span><span class="w">i</span><span class="pc">r</span><span class="c">q.h&gt;</span>
<span class="c">#include</span> <span class="c">&lt;linux/</span><span class="w">i</span><span class="pc">n</span><span class="c">terrupt.h&gt;</span>
<span class="c">#include</span> <span class="c">&lt;linux/</span><span class="pc">u</span><span class="c">sb/</span><span class="w">mu</span><span class="c">sb.h&gt;</span>
<span class="c">#include</span> <span class="c">&lt;linux/</span><span class="w">leds</span><span class="pc">.</span><span class="c">h&gt;</span>
<span class="c">#include</span> <span class="c">&lt;linux/</span><span class="w">in</span><span class="pc">p</span><span class="c">ut.h&gt;</span>
<span class="c">#include</span> <span class="c">&lt;</span><span class="pc">a</span><span class="c">sm/</span><span class="w">d</span><span class="pc">m</span><span class="c">a.h&gt;</span>
<span class="c">#include</span> <span class="c">&lt;asm/</span><span class="w">bfin5xx_spi</span><span class="c">.h&gt;</span>
<span class="c">#include</span> <span class="c">&lt;asm/</span><span class="w">reboot</span><span class="c">.h&gt;</span>
<span class="c">#include</span> <span class="c">&lt;asm/</span><span class="w">nand</span><span class="c">.h&gt;</span>
<span class="c">#include</span> <span class="c">&lt;asm/</span><span class="w">portmux</span><span class="c">.h&gt;</span>
<span class="c">#include</span> <span class="c">&lt;asm/</span><span class="w">dpmc</span><span class="c">.h&gt;</span>



<span class="w">c</span><span class="c">onst</span> <span class="pc">c</span><span class="c">har</span> <span class="w">bfin_board_name[] = "ADI</span> <span class="w">BF527</span><span class="pc">-</span><span class="w">AD7160EVAL";</span>



<span class="c">#</span><span class="pc">if</span> <span class="pc">I</span><span class="c">S_ENABLED(</span><span class="w">CONFIG_USB_MUSB_HDRC</span><span class="c">)</span>
<span class="pc">sta</span><span class="c">tic</span> <span class="pc">s</span><span class="c">truct</span> <span class="w">r</span><span class="c">esource</span> <span class="w">musb_resources</span><span class="c">[] = {</span>
	<span class="pc">[</span><span class="w">0</span><span class="pc">] = </span><span class="c">{</span>
		<span class="pc">.</span><span class="w">s</span><span class="pc">t</span><span class="c">art</span>	<span class="c">=</span> <span class="w">0xffc03800</span><span class="c">,</span>
		<span class="c">.</span><span class="w">e</span><span class="c">nd</span>	<span class="c">=</span> <span class="w">0xffc03cff</span><span class="c">,</span>
		<span class="c">.</span><span class="pc">f</span><span class="c">lags</span>	<span class="c">=</span> <span class="w">I</span><span class="pc">ORESOURCE_M</span><span class="c">EM,</span>
	<span class="pc">}</span><span class="c">,</span>
	<span class="pc">[</span><span class="w">1</span><span class="c">] = {</span>	
		<span class="c">.</span><span class="w">s</span><span class="pc">t</span><span class="c">art</span>	<span class="c">=</span> <span class="w">IRQ_USB_INT0</span><span class="c">,</span>
		<span class="c">.</span><span class="w">e</span><span class="c">nd</span>	<span class="c">=</span> <span class="w">I</span><span class="c">RQ_USB_INT0,</span>
		<span class="c">.</span><span class="pc">f</span><span class="c">lags</span>	<span class="c">=</span> <span class="w">I</span><span class="pc">O</span><span class="c">RESOURCE_IRQ</span> <span class="pc">|</span> <span class="w">IORESOURCE_IRQ_HIGHLEVEL</span><span class="c">,</span>
	<span class="pc">},</span>
	<span class="c">[</span><span class="pc">2</span><span class="c">] = {</span>	
		<span class="c">.</span><span class="w">s</span><span class="pc">t</span><span class="c">art</span>	<span class="c">=</span> <span class="w">IRQ_USB_DMA</span><span class="c">,</span>
		<span class="c">.</span><span class="w">e</span><span class="c">nd</span>	<span class="c">=</span> <span class="w">I</span><span class="pc">RQ_USB_D</span><span class="c">MA,</span>
		<span class="c">.flags</span>	<span class="c">=</span> <span class="w">I</span><span class="pc">O</span><span class="c">RESOURCE_IRQ</span> <span class="pc">|</span> <span class="c">IORESOURCE_IRQ_HIGHLEVEL,</span>
	<span class="pc">},</span>
<span class="c">};</span>

<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="w">musb_hdrc_config</span> <span class="w">musb_config</span> <span class="c">= {</span>
	<span class="c">.</span><span class="w">multipoint</span>	<span class="c">=</span> <span class="pc">0</span><span class="c">,</span>
	<span class="c">.</span><span class="w">dyn_fifo</span>	<span class="c">=</span> <span class="pc">0</span><span class="c">,</span>
	<span class="c">.</span><span class="w">soft_con</span>	<span class="c">=</span> <span class="c">1,</span>
	<span class="c">.</span><span class="w">dm</span><span class="c">a</span>		<span class="c">=</span> <span class="c">1,</span>
	<span class="c">.</span><span class="w">num_eps</span>	<span class="c">=</span> <span class="w">8</span><span class="c">,</span>
	<span class="c">.</span><span class="w">dma_channels</span>	<span class="c">=</span> <span class="pc">8</span><span class="c">,</span>
	<span class="c">.</span><span class="w">gpio_vrsel</span>	<span class="c">=</span> <span class="w">GPIO_PG13</span><span class="c">,</span>
	
	<span class="c">.</span><span class="w">gpio_vrsel_active</span>	<span class="c">=</span> <span class="c">1,</span>
	<span class="c">.</span><span class="w">clkin</span>          <span class="c">=</span> <span class="w">2</span><span class="pc">4</span><span class="c">,</span>           
<span class="pc">};</span>

<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="w">musb_hdrc_platform_data</span> <span class="w">musb_plat</span> <span class="c">= {</span>
<span class="pc">#if</span> <span class="pc">d</span><span class="c">efined(</span><span class="w">CONFIG_USB_MUSB_OTG</span><span class="c">)</span>
	<span class="w">.</span><span class="pc">m</span><span class="c">ode</span>		<span class="c">=</span> <span class="w">MUSB_OTG</span><span class="c">,</span>
<span class="pc">#</span><span class="w">e</span><span class="pc">li</span><span class="c">f</span> <span class="c">defined(</span><span class="w">CONFIG_USB_MUSB_HDRC_HCD</span><span class="c">)</span>
	<span class="w">.m</span><span class="pc">o</span><span class="c">de</span>		<span class="c">=</span> <span class="w">MUSB_HOST</span><span class="c">,</span>
<span class="pc">#</span><span class="w">e</span><span class="pc">li</span><span class="c">f</span> <span class="c">defined(</span><span class="w">CONFIG_USB_GADGET_MUSB_HDRC</span><span class="c">)</span>
	<span class="w">.m</span><span class="c">ode</span>		<span class="c">=</span> <span class="w">MUSB_PERIPHERAL,</span>
<span class="pc">#</span><span class="c">endif</span>
	<span class="pc">.</span><span class="w">c</span><span class="pc">on</span><span class="c">fig</span>		<span class="pc">= </span><span class="c">&amp;</span><span class="w">musb_config</span><span class="c">,</span>
<span class="pc">}</span><span class="c">;</span>

<span class="c">static</span> <span class="w">u6</span><span class="c">4</span> <span class="w">musb_dmamask</span> <span class="w">= ~(u</span><span class="pc">3</span><span class="c">2</span><span class="w">)0</span><span class="pc">;</span>

<span class="pc">s</span><span class="c">tatic</span> <span class="pc">s</span><span class="c">truct</span> <span class="pc">p</span><span class="c">latform_device</span> <span class="w">musb_device</span> <span class="pc">=</span><span class="c"> {</span>
	<span class="c">.name</span>		<span class="c">= "</span><span class="w">mu</span><span class="pc">sb-</span><span class="w">blackfin</span><span class="c">",</span>
	<span class="c">.id</span>		<span class="c">=</span> <span class="c">0,</span>
	<span class="c">.</span><span class="w">dev</span> <span class="pc">= {</span>
		<span class="c">.</span><span class="w">dma_mask</span>		<span class="pc">= </span><span class="c">&amp;</span><span class="w">m</span><span class="pc">usb_dm</span><span class="c">amask,</span>
		<span class="c">.</span><span class="w">coherent_dma_mask</span>	<span class="c">=</span> <span class="w">0xf</span><span class="pc">ffff</span><span class="c">fff,</span>
		<span class="pc">.</span><span class="w">pl</span><span class="c">atform_data</span>		<span class="pc">= </span><span class="c">&amp;</span><span class="w">musb_plat</span><span class="c">,</span>
	<span class="pc">}</span><span class="c">,</span>
	<span class="c">.</span><span class="w">n</span><span class="pc">um_r</span><span class="c">esources</span>	<span class="c">=</span> <span class="w">A</span><span class="c">RRAY_SIZE(</span><span class="w">musb_resources</span><span class="c">),</span>
	<span class="c">.</span><span class="w">res</span><span class="pc">ource</span>	<span class="c">=</span> <span class="c">musb_resources,</span>
<span class="pc">};</span>
<span class="w">#</span><span class="pc">e</span><span class="c">ndif</span>

<span class="pc">#if</span> <span class="c">IS_ENABLED(</span><span class="w">CONFIG_FB_BFIN_RA158Z</span><span class="pc">)</span>
<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="pc">r</span><span class="c">esource</span> <span class="w">bf52x_ra158z_resources</span><span class="c">[] = {</span>
	<span class="c">{</span>
		<span class="c">.</span><span class="w">s</span><span class="c">tart</span> <span class="pc">=</span> <span class="w">IRQ_PPI_ERROR</span><span class="c">,</span>
		<span class="c">.</span><span class="w">e</span><span class="c">nd</span> <span class="c">=</span> <span class="pc">I</span><span class="c">RQ_PPI_ERROR,</span>
		<span class="c">.flags</span> <span class="c">=</span> <span class="pc">IO</span><span class="c">RESOURCE_IRQ,</span>
	<span class="pc">}</span><span class="c">,</span>
<span class="c">};</span>

<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="pc">p</span><span class="c">latform_device</span> <span class="w">bf52x_ra158z_device</span> <span class="pc">=</span><span class="c"> {</span>
	<span class="c">.name</span>		<span class="c">= "</span><span class="w">bfin</span><span class="pc">-</span><span class="w">ra158z</span><span class="c">",</span>
	<span class="c">.</span><span class="pc">id</span>		<span class="w">=</span><span class="pc"> -</span><span class="c">1,</span>
	<span class="c">.</span><span class="w">n</span><span class="pc">u</span><span class="c">m_resources</span>	<span class="c">=</span> <span class="pc">A</span><span class="c">RRAY_SIZE(</span><span class="w">bf52x_ra158z_resources</span><span class="c">),</span>
	<span class="pc">.</span><span class="w">res</span><span class="pc">ource</span>	<span class="c">=</span> <span class="c">bf52x_ra158z_resources,</span>
<span class="c">};</span>
<span class="w">#</span><span class="pc">e</span><span class="c">ndif</span>

<span class="pc">#if</span> <span class="c">IS_ENABLED(</span><span class="w">CONFIG_MTD_PHYSMAP</span><span class="c">)</span>
<span class="c">static</span> <span class="c">struct</span> <span class="w">mtd_partition</span> <span class="w">ad7160eval_partitions</span><span class="c">[] = {</span>
	<span class="c">{</span>
		<span class="c">.name</span>       <span class="c">= "</span><span class="w">bootloader(nor</span><span class="pc">)</span><span class="c">",</span>
		<span class="c">.</span><span class="w">s</span><span class="pc">i</span><span class="c">ze</span>       <span class="c">=</span> <span class="w">0x4</span><span class="pc">00</span><span class="c">00,</span>
		<span class="c">.</span><span class="w">o</span><span class="pc">f</span><span class="c">fset</span>     <span class="c">=</span> <span class="pc">0</span><span class="c">,</span>
	<span class="pc">}, </span><span class="c">{</span>
		<span class="c">.name</span>       <span class="c">= "</span><span class="w">l</span><span class="pc">i</span><span class="c">nux</span> <span class="w">k</span><span class="pc">er</span><span class="c">nel</span><span class="w">(</span><span class="pc">no</span><span class="c">r</span><span class="w">)</span><span class="pc">"</span><span class="c">,</span>
		<span class="c">.</span><span class="w">s</span><span class="pc">i</span><span class="c">ze</span>       <span class="c">=</span> <span class="w">0x1C0000</span><span class="c">,</span>
		<span class="c">.</span><span class="w">o</span><span class="pc">f</span><span class="c">fset</span>     <span class="c">=</span> <span class="w">MTDPART_OFS_APPEND</span><span class="c">,</span>
	<span class="pc">}, </span><span class="c">{</span>
		<span class="c">.name</span>       <span class="c">= "</span><span class="w">f</span><span class="pc">ile</span> <span class="w">system(</span><span class="c">nor</span><span class="w">)</span><span class="c">",</span>
		<span class="c">.</span><span class="w">s</span><span class="pc">i</span><span class="c">ze</span>       <span class="c">=</span> <span class="w">MTDPART_SIZ_FULL</span><span class="c">,</span>
		<span class="c">.</span><span class="w">o</span><span class="pc">f</span><span class="c">fset</span>     <span class="c">=</span> <span class="pc">M</span><span class="c">TDPART_OFS_APPEND,</span>
	<span class="pc">}</span>
<span class="pc">}</span><span class="c">;</span>

<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="w">physmap_flash_data</span> <span class="w">ad7160eval_flash_data</span> <span class="c">= {</span>
	<span class="c">.</span><span class="w">w</span><span class="pc">i</span><span class="c">dth</span>      <span class="c">=</span> <span class="w">2</span><span class="c">,</span>
	<span class="c">.</span><span class="w">parts</span>      <span class="c">=</span> <span class="w">ad7160eval_partitions</span><span class="c">,</span>
	<span class="c">.</span><span class="w">nr_parts</span>   <span class="c">=</span> <span class="w">A</span><span class="c">RRAY_SIZE(ad7160eval_partitions),</span>
<span class="pc">}</span><span class="c">;</span>

<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="pc">r</span><span class="c">esource</span> <span class="w">ad7160eval_flash_resource</span> <span class="c">= {</span>
	<span class="c">.</span><span class="w">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">0x20</span><span class="pc">0000</span><span class="c">00,</span>
	<span class="c">.</span><span class="w">e</span><span class="pc">nd</span>   <span class="c">=</span> <span class="w">0x203fffff</span><span class="c">,</span>
	<span class="c">.flags</span> <span class="c">=</span> <span class="w">I</span><span class="pc">ORESOURCE_M</span><span class="c">EM,</span>
<span class="pc">}</span><span class="c">;</span>

<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="pc">p</span><span class="c">latform_device</span> <span class="w">ad7160eval_flash_device</span> <span class="c">= {</span>
	<span class="c">.name</span>          <span class="c">= "</span><span class="w">physmap</span><span class="pc">-</span><span class="w">f</span><span class="c">lash",</span>
	<span class="c">.id</span>            <span class="c">=</span> <span class="pc">0</span><span class="c">,</span>
	<span class="c">.</span><span class="w">de</span><span class="pc">v</span> <span class="pc">= {</span>
		<span class="c">.</span><span class="w">p</span><span class="pc">l</span><span class="c">atform_data</span> <span class="c">= &amp;</span><span class="w">ad7160eval_flash_data</span><span class="c">,</span>
	<span class="pc">}</span><span class="c">,</span>
	<span class="pc">.</span><span class="w">nu</span><span class="pc">m_r</span><span class="c">esources</span> <span class="c">=</span> <span class="c">1,</span>
	<span class="c">.</span><span class="w">res</span><span class="pc">ource</span>      <span class="pc">= &amp;</span><span class="w">ad7160eval_flash_resource</span><span class="c">,</span>
<span class="pc">}</span><span class="c">;</span>
<span class="pc">#</span><span class="c">endif</span>

<span class="pc">#if</span> <span class="pc">I</span><span class="c">S_ENABLED(</span><span class="w">CONFIG_MTD_NAND_BF5XX</span><span class="c">)</span>
<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="w">mtd_partition</span> <span class="w">partition_info</span><span class="c">[] = {</span>
	<span class="c">{</span>
		<span class="c">.name</span> <span class="c">= "</span><span class="w">li</span><span class="pc">nu</span><span class="c">x</span> <span class="w">k</span><span class="pc">er</span><span class="c">nel</span><span class="w">(nand)</span><span class="pc">"</span><span class="c">,</span>
		<span class="c">.</span><span class="w">o</span><span class="pc">f</span><span class="c">fset</span> <span class="c">=</span> <span class="pc">0,</span>
		<span class="c">.</span><span class="w">s</span><span class="c">ize</span> <span class="c">=</span> <span class="w">4</span> <span class="w">*</span> <span class="pc">1</span><span class="c">024</span> <span class="pc">*</span> <span class="c">1024</span><span class="pc">,</span>
	<span class="pc">},</span>
	<span class="c">{</span>
		<span class="c">.</span><span class="pc">n</span><span class="c">ame</span> <span class="c">= "</span><span class="w">f</span><span class="pc">ile</span> <span class="w">system(</span><span class="pc">n</span><span class="c">and</span><span class="w">)</span><span class="pc">"</span><span class="c">,</span>
		<span class="c">.</span><span class="w">o</span><span class="c">ffset</span> <span class="c">=</span> <span class="w">MTDPART_OFS_APPEND</span><span class="pc">,</span>
		<span class="c">.</span><span class="pc">s</span><span class="c">ize</span> <span class="c">=</span> <span class="w">MTDPART_SIZ_FULL</span><span class="c">,</span>
	<span class="pc">}</span><span class="c">,</span>
<span class="pc">}</span><span class="c">;</span>

<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="w">bf5xx_nand_platform</span> <span class="pc">b</span><span class="c">f5xx_nand_platform</span> <span class="c">= {</span>
	<span class="c">.</span><span class="w">data_width</span> <span class="c">=</span> <span class="w">NFC_NWIDTH_8</span><span class="c">,</span>
	<span class="c">.</span><span class="w">partitions</span> <span class="c">=</span> <span class="w">partition_info</span><span class="c">,</span>
	<span class="c">.</span><span class="w">nr_partitions</span> <span class="c">=</span> <span class="w">A</span><span class="c">RRAY_SIZE(partition_info),</span>
	<span class="c">.</span><span class="w">rd_dly</span> <span class="c">=</span> <span class="w">3</span><span class="c">,</span>
	<span class="c">.</span><span class="w">wr_dly</span> <span class="c">=</span> <span class="w">3</span><span class="c">,</span>
<span class="pc">}</span><span class="c">;</span>

<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="w">r</span><span class="c">esource</span> <span class="w">bf5xx_nand_resources</span><span class="pc">[</span><span class="c">] = {</span>
	<span class="pc">{</span>
		<span class="c">.</span><span class="w">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">NFC_CTL</span><span class="c">,</span>
		<span class="c">.</span><span class="w">e</span><span class="c">nd</span> <span class="c">=</span> <span class="w">NFC_DATA_RD</span> <span class="w">+</span> <span class="pc">2</span><span class="c">,</span>
		<span class="c">.</span><span class="w">f</span><span class="c">lags</span> <span class="c">=</span> <span class="w">I</span><span class="pc">ORESOURCE_M</span><span class="c">EM,</span>
	<span class="pc">},</span>
	<span class="pc">{</span>
		<span class="c">.</span><span class="pc">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">CH_NFC</span><span class="c">,</span>
		<span class="c">.</span><span class="pc">e</span><span class="c">nd</span> <span class="c">=</span> <span class="pc">C</span><span class="c">H_NFC,</span>
		<span class="c">.</span><span class="pc">f</span><span class="c">lags</span> <span class="c">=</span> <span class="w">I</span><span class="c">ORESOURCE_IRQ,</span>
	<span class="pc">}</span><span class="c">,</span>
<span class="pc">}</span><span class="c">;</span>

<span class="c">static</span> <span class="c">struct</span> <span class="pc">p</span><span class="c">latform_device</span> <span class="w">bf5xx_nand_device</span> <span class="pc">=</span><span class="c"> {</span>
	<span class="c">.name</span> <span class="c">= "</span><span class="w">bf5xx</span><span class="pc">-</span><span class="w">nand</span><span class="c">",</span>
	<span class="c">.</span><span class="pc">i</span><span class="c">d</span> <span class="c">=</span> <span class="pc">0</span><span class="c">,</span>
	<span class="c">.</span><span class="w">n</span><span class="pc">u</span><span class="c">m_resources</span> <span class="c">=</span> <span class="c">ARRAY_SIZE(</span><span class="w">bf5xx_nand_resources</span><span class="c">),</span>
	<span class="pc">.</span><span class="w">res</span><span class="pc">ource</span> <span class="c">=</span> <span class="c">bf5xx_nand_resources,</span>
	<span class="pc">.</span><span class="w">dev</span> <span class="pc">= {</span>
		<span class="c">.</span><span class="w">p</span><span class="pc">l</span><span class="c">atform_data</span> <span class="c">= &amp;</span><span class="w">bf5xx_nand_platform</span><span class="c">,</span>
	<span class="pc">}</span><span class="c">,</span>
<span class="c">};</span>
<span class="w">#</span><span class="pc">e</span><span class="c">ndif</span>

<span class="pc">#if</span> <span class="c">IS_ENABLED(</span><span class="w">CONFIG_RTC_DRV_BFIN</span><span class="c">)</span>
<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="c">platform_device</span> <span class="w">rtc_device</span> <span class="pc">=</span><span class="c"> {</span>
	<span class="c">.</span><span class="pc">n</span><span class="c">ame</span> <span class="c">= "</span><span class="pc">r</span><span class="c">tc</span><span class="pc">-</span><span class="w">bfin</span><span class="c">",</span>
	<span class="c">.id</span>   <span class="w">= </span><span class="pc">-</span><span class="c">1,</span>
<span class="pc">}</span><span class="c">;</span>
<span class="pc">#</span><span class="c">endif</span>

<span class="pc">#if</span> <span class="pc">I</span><span class="c">S_ENABLED(</span><span class="w">CONFIG_BFIN_MAC</span><span class="c">)</span>
<span class="pc">#i</span><span class="c">nclude</span> <span class="c">&lt;linux/</span><span class="w">bfin_mac</span><span class="c">.h&gt;</span>
<span class="pc">sta</span><span class="c">tic</span> <span class="pc">c</span><span class="c">onst</span> <span class="pc">u</span><span class="c">nsigned</span> <span class="pc">s</span><span class="c">hort</span> <span class="w">bfin_mac_peripherals[] =</span> <span class="w">P_RMII0</span><span class="pc">;</span>

<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="w">bfin_phydev_platform_data</span> <span class="w">bfin_phydev_data</span><span class="pc">[]</span><span class="c"> = {</span>
	<span class="c">{</span>
		<span class="c">.</span><span class="w">a</span><span class="c">ddr</span> <span class="c">=</span> <span class="pc">1</span><span class="c">,</span>
		<span class="c">.</span><span class="w">i</span><span class="pc">r</span><span class="c">q</span> <span class="c">=</span> <span class="w">IRQ_MAC_PHYINT</span><span class="c">,</span>
	<span class="pc">}</span><span class="c">,</span>
<span class="c">};</span>

<span class="pc">s</span><span class="c">tatic</span> <span class="pc">s</span><span class="c">truct</span> <span class="w">bfin_mii_bus_platform_data</span> <span class="w">bfin_mii_bus_data</span> <span class="c">= {</span>
	<span class="c">.</span><span class="w">phydev_number</span> <span class="c">=</span> <span class="pc">1</span><span class="c">,</span>
	<span class="c">.</span><span class="w">phydev_data</span> <span class="c">=</span> <span class="pc">b</span><span class="c">fin_phydev_data,</span>
	<span class="c">.</span><span class="w">phy_mode</span> <span class="c">=</span> <span class="w">PHY_INTERFACE_MODE_RMII</span><span class="c">,</span>
	<span class="c">.</span><span class="w">mac_peripherals</span> <span class="c">=</span> <span class="w">bfin_mac_peripherals</span><span class="c">,</span>
<span class="pc">};</span>

<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="pc">p</span><span class="c">latform_device</span> <span class="w">bfin_mii_bus</span> <span class="c">= {</span>
	<span class="c">.name</span> <span class="c">= "</span><span class="w">b</span><span class="pc">fin_mii_bus</span><span class="c">",</span>
	<span class="c">.</span><span class="w">de</span><span class="pc">v</span> <span class="pc">= {</span>
		<span class="c">.</span><span class="w">pl</span><span class="c">atform_data</span> <span class="pc">= &amp;</span><span class="w">bf</span><span class="pc">in_mii_bus_d</span><span class="c">ata,</span>
	<span class="w">}</span>
<span class="c">};</span>

<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="c">platform_device</span> <span class="w">bfin_mac_device</span> <span class="pc">=</span><span class="c"> {</span>
	<span class="c">.</span><span class="pc">n</span><span class="c">ame</span> <span class="c">= "</span><span class="w">bfin_mac</span><span class="c">",</span>
	<span class="c">.</span><span class="w">de</span><span class="pc">v</span> <span class="pc">= {</span>
		<span class="c">.</span><span class="w">p</span><span class="pc">l</span><span class="c">atform_data</span> <span class="c">= &amp;</span><span class="pc">b</span><span class="c">fin_mii_bus,</span>
	<span class="w">}</span>
<span class="c">};</span>
<span class="pc">#e</span><span class="c">ndif</span>


<span class="pc">#if</span> <span class="c">IS_ENABLED(</span><span class="w">CONFIG_MTD_M25P80</span><span class="c">)</span>
<span class="c">static</span> <span class="c">struct</span> <span class="w">mtd_partition</span> <span class="w">bfin_spi_flash_partitions</span><span class="pc">[</span><span class="c">] = {</span>
	<span class="c">{</span>
		<span class="c">.name</span> <span class="c">= "</span><span class="w">bootloader(s</span><span class="pc">p</span><span class="c">i</span><span class="w">)</span><span class="pc">"</span><span class="c">,</span>
		<span class="c">.</span><span class="w">s</span><span class="pc">i</span><span class="c">ze</span> <span class="c">=</span> <span class="w">0x00040000</span><span class="c">,</span>
		<span class="c">.</span><span class="w">o</span><span class="pc">f</span><span class="c">fset</span> <span class="c">=</span> <span class="pc">0</span><span class="c">,</span>
		<span class="pc">.</span><span class="w">mask_flags</span> <span class="c">=</span> <span class="w">MTD_CAP_ROM</span>
	<span class="w">}</span><span class="pc">, </span><span class="c">{</span>
		<span class="c">.name</span> <span class="c">= "</span><span class="w">l</span><span class="c">inux</span> <span class="w">k</span><span class="pc">e</span><span class="c">rnel</span><span class="w">(sp</span><span class="pc">i</span><span class="w">)</span><span class="pc">"</span><span class="c">,</span>
		<span class="c">.</span><span class="w">s</span><span class="pc">i</span><span class="c">ze</span> <span class="c">=</span> <span class="w">MTDPART_SIZ_FULL</span><span class="c">,</span>
		<span class="c">.</span><span class="w">o</span><span class="pc">f</span><span class="c">fset</span> <span class="c">=</span> <span class="w">MTDPART_OFS_APPEND</span><span class="c">,</span>
	<span class="pc">}</span>
<span class="c">};</span>

<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="w">flash_platform_data</span> <span class="w">bfin_spi_flash_data</span> <span class="c">= {</span>
	<span class="c">.name</span> <span class="c">= "</span><span class="w">m25p80</span><span class="c">",</span>
	<span class="c">.</span><span class="w">parts</span> <span class="c">=</span> <span class="w">bfin_spi_flash_partitions</span><span class="c">,</span>
	<span class="c">.</span><span class="w">nr_parts</span> <span class="c">=</span> <span class="w">A</span><span class="c">RRAY_SIZE(bfin_spi_flash_partitions),</span>
	<span class="c">.</span><span class="w">t</span><span class="c">ype</span> <span class="pc">= "</span><span class="w">m25p16</span><span class="c">",</span>
<span class="pc">}</span><span class="c">;</span>


<span class="c">static</span> <span class="c">struct</span> <span class="w">bfin5xx_spi_chip</span> <span class="w">spi_flash_chip_info</span> <span class="c">= {</span>
	<span class="c">.</span><span class="w">enable_dma</span> <span class="c">=</span> <span class="w">0</span><span class="c">,</span>         
<span class="pc">}</span><span class="c">;</span>
<span class="pc">#e</span><span class="c">ndif</span>

<span class="c">#</span><span class="pc">if</span> <span class="c">IS_ENABLED(</span><span class="w">CONFIG_MMC_SPI</span><span class="c">)</span>
<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="w">b</span><span class="c">fin5xx_spi_chip</span>  <span class="w">mmc_spi_chip_info</span> <span class="c">= {</span>
	<span class="c">.</span><span class="w">e</span><span class="pc">nable_</span><span class="c">dma</span> <span class="c">=</span> <span class="pc">0</span><span class="c">,</span>
<span class="pc">}</span><span class="c">;</span>
<span class="pc">#</span><span class="c">endif</span>

<span class="pc">#if</span> <span class="c">IS_ENABLED(</span><span class="w">CONFIG_SND_BF5XX_I2S</span><span class="c">)</span>
<span class="pc">sta</span><span class="c">tic</span> <span class="pc">s</span><span class="c">truct</span> <span class="pc">p</span><span class="c">latform_device</span> <span class="w">bfin_i2s</span> <span class="w">=</span><span class="c"> {</span>
	<span class="c">.</span><span class="pc">n</span><span class="c">ame</span> <span class="c">= "</span><span class="w">bfin</span><span class="pc">-</span><span class="w">i2s</span><span class="c">",</span>
	<span class="c">.</span><span class="pc">i</span><span class="c">d</span> <span class="c">=</span> <span class="w">CONFIG_SND_BF5XX_SPORT_NUM</span><span class="c">,</span>
	
<span class="pc">}</span><span class="c">;</span>
<span class="pc">#</span><span class="c">endif</span>

<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="w">spi_board_info</span> <span class="w">bfin_spi_board_info</span><span class="pc">[]</span> <span class="pc">_</span><span class="c">_initdata</span> <span class="c">= {</span>
<span class="pc">#if</span> <span class="c">IS_ENABLED(</span><span class="w">CONFIG_MTD_M25P80</span><span class="c">)</span>
	<span class="w">{</span>
		
		<span class="c">.</span><span class="w">modalias</span> <span class="pc">= </span><span class="c">"</span><span class="w">m25p80</span><span class="c">",</span> 
		<span class="c">.</span><span class="w">max_speed_hz</span> <span class="c">=</span> <span class="w">25000000</span><span class="c">,</span>     
		<span class="c">.</span><span class="w">bus_num</span> <span class="c">=</span> <span class="w">0</span><span class="c">,</span> 
		<span class="c">.</span><span class="w">chip_select</span> <span class="c">=</span> <span class="c">1,</span> 
		<span class="c">.</span><span class="w">pl</span><span class="c">atform_data</span> <span class="c">= &amp;</span><span class="w">bfin_spi_flash_data</span><span class="c">,</span>
		<span class="c">.</span><span class="w">controller_data</span> <span class="pc">= </span><span class="c">&amp;</span><span class="w">spi_flash_chip_info</span><span class="c">,</span>
		<span class="c">.</span><span class="w">mo</span><span class="pc">de</span> <span class="c">=</span> <span class="w">SPI_MODE_3</span><span class="c">,</span>
	<span class="pc">},</span>
<span class="w">#</span><span class="c">endif</span>
<span class="c">#</span><span class="pc">if</span> <span class="c">IS_ENABLED(</span><span class="w">CONFIG_SND_BF5XX_SOC_AD183X</span><span class="c">)</span>
	<span class="w">{</span>
		<span class="pc">.</span><span class="w">modalias</span> <span class="pc">= "</span><span class="w">ad183x</span><span class="c">",</span>
		<span class="c">.</span><span class="w">max_speed_hz</span> <span class="c">=</span> <span class="w">3125000</span><span class="c">,</span>     
		<span class="c">.</span><span class="w">bus_num</span> <span class="c">=</span> <span class="pc">0</span><span class="c">,</span>
		<span class="c">.</span><span class="w">chip_select</span> <span class="c">=</span> <span class="w">4</span><span class="c">,</span>
	<span class="pc">}</span><span class="c">,</span>
<span class="w">#</span><span class="pc">e</span><span class="c">ndif</span>
<span class="pc">#if</span> <span class="c">IS_ENABLED(</span><span class="w">CONFIG_MMC_SPI</span><span class="c">)</span>
	<span class="w">{</span>
		<span class="pc">.</span><span class="w">m</span><span class="pc">o</span><span class="c">dalias</span> <span class="pc">= </span><span class="c">"</span><span class="w">mmc_spi</span><span class="c">",</span>
		<span class="c">.</span><span class="w">m</span><span class="pc">a</span><span class="c">x_speed_hz</span> <span class="c">=</span> <span class="w">30000000</span><span class="c">,</span>     
		<span class="c">.bus_num</span> <span class="c">=</span> <span class="pc">0</span><span class="c">,</span>
		<span class="c">.</span><span class="pc">c</span><span class="c">hip_select</span> <span class="c">=</span> <span class="w">GPIO_PH3</span> <span class="w">+</span> <span class="w">MAX_CTRL_CS</span><span class="c">,</span>
		<span class="c">.</span><span class="w">controller_data</span> <span class="pc">= </span><span class="c">&amp;</span><span class="w">mmc_spi_chip_info</span><span class="c">,</span>
		<span class="c">.</span><span class="w">mo</span><span class="pc">de</span> <span class="c">=</span> <span class="w">SPI_MODE_3</span><span class="c">,</span>
	<span class="pc">},</span>
<span class="pc">#</span><span class="c">endif</span>
<span class="pc">#if</span> <span class="c">IS_ENABLED(</span><span class="w">CONFIG_SPI_SPIDEV</span><span class="c">)</span>
	<span class="w">{</span>
		<span class="c">.</span><span class="w">modalias</span> <span class="pc">= "</span><span class="w">spidev</span><span class="pc">"</span><span class="c">,</span>
		<span class="c">.</span><span class="w">max_speed_hz</span> <span class="c">=</span> <span class="w">3125000</span><span class="c">,</span>     
		<span class="c">.</span><span class="w">bus_num</span> <span class="c">=</span> <span class="w">0</span><span class="c">,</span>
		<span class="c">.</span><span class="w">chip_select</span> <span class="c">=</span> <span class="c">1,</span>
	<span class="pc">},</span>
<span class="w">#</span><span class="pc">e</span><span class="c">ndif</span>
<span class="w">}</span><span class="pc">;</span>

<span class="pc">#if</span> <span class="c">IS_ENABLED(</span><span class="w">CONFIG_SPI_BFIN5XX</span><span class="c">)</span>

<span class="pc">s</span><span class="c">tatic</span> <span class="c">struct</span> <span class="w">bfin5xx_spi_master</span> <span class="w">bfin_spi0_info</span> <span class="c">= {</span>
	<span class="c">.</span><span class="w">num_chipselect</span> <span class="c">=</span> <span class="w">MAX_CTRL_CS</span> <span class="w">+</span> <span class="w">MAX_BLACKFIN_GPIOS</span><span class="pc">,</span>
	<span class="c">.</span><span class="w">enable_dma</span> <span class="c">=</span> <span class="c">1,</span>  
	<span class="c">.</span><span class="w">pin_req</span> <span class="pc">= {</span><span class="w">P_SPI0_SCK</span><span class="pc">,</span> <span class="w">P_SPI0_MISO</span><span class="c">,</span> <span class="w">P_SPI0_MOSI</span><span class="c">,</span> <span class="pc">0},</span>
<span class="c">};</span>


<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="w">r</span><span class="c">esource</span> <span class="w">bfin_spi0_resource</span><span class="c">[] = {</span>
	<span class="pc">[</span><span class="c">0] = {</span>
		<span class="c">.</span><span class="w">st</span><span class="pc">ar</span><span class="c">t</span> <span class="c">=</span> <span class="w">SPI0_REGBASE</span><span class="c">,</span>
		<span class="c">.</span><span class="w">e</span><span class="pc">nd</span>   <span class="c">=</span> <span class="w">S</span><span class="c">PI0_REGBASE</span> <span class="pc">+</span> <span class="w">0xF</span><span class="pc">F</span><span class="c">,</span>
		<span class="c">.</span><span class="pc">f</span><span class="c">lags</span> <span class="c">=</span> <span class="w">I</span><span class="pc">ORESOURCE_M</span><span class="c">EM,</span>
		<span class="c">},</span>
	<span class="pc">[1</span><span class="c">] = {</span>
		<span class="pc">.</span><span class="w">s</span><span class="pc">t</span><span class="c">art</span> <span class="c">=</span> <span class="w">CH_SPI</span><span class="c">,</span>
		<span class="c">.</span><span class="w">e</span><span class="c">nd</span>   <span class="c">=</span> <span class="w">C</span><span class="c">H_SPI,</span>
		<span class="c">.flags</span> <span class="c">=</span> <span class="w">IORESOURCE_DMA</span><span class="c">,</span>
	<span class="pc">}</span><span class="c">,</span>
	<span class="c">[</span><span class="pc">2</span><span class="c">] = {</span>
		<span class="c">.</span><span class="w">s</span><span class="pc">t</span><span class="c">art</span> <span class="c">=</span> <span class="w">IRQ_SPI</span><span class="c">,</span>
		<span class="c">.</span><span class="w">e</span><span class="c">nd</span>   <span class="c">=</span> <span class="w">I</span><span class="c">RQ_SPI,</span>
		<span class="pc">.</span><span class="c">flags</span> <span class="c">=</span> <span class="w">I</span><span class="pc">ORESOURCE_I</span><span class="c">RQ,</span>
	<span class="c">},</span>
<span class="pc">}</span><span class="c">;</span>

<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="pc">p</span><span class="c">latform_device</span> <span class="w">bfin_spi0_device</span> <span class="pc">=</span><span class="c"> {</span>
	<span class="c">.name</span> <span class="c">= "</span><span class="w">bfin</span><span class="pc">-</span><span class="w">sp</span><span class="c">i</span><span class="pc">"</span><span class="c">,</span>
	<span class="c">.</span><span class="pc">i</span><span class="c">d</span> <span class="c">=</span> <span class="pc">0</span><span class="c">,</span> 
	<span class="c">.</span><span class="w">n</span><span class="pc">u</span><span class="c">m_resources</span> <span class="c">=</span> <span class="pc">A</span><span class="c">RRAY_SIZE(</span><span class="w">bfin_spi0_resource</span><span class="c">),</span>
	<span class="pc">.</span><span class="w">res</span><span class="pc">ource</span> <span class="c">=</span> <span class="c">bfin_spi0_resource,</span>
	<span class="pc">.</span><span class="w">dev</span> <span class="pc">= {</span>
		<span class="c">.</span><span class="w">p</span><span class="pc">l</span><span class="c">atform_data</span> <span class="c">= &amp;</span><span class="w">bfin_spi0_info</span><span class="c">,</span> 
	<span class="pc">}</span><span class="c">,</span>
<span class="pc">}</span><span class="c">;</span>
<span class="w">#</span><span class="pc">e</span><span class="c">ndif</span>  

<span class="pc">#if</span> <span class="c">IS_ENABLED(</span><span class="w">CONFIG_SERIAL_BFIN</span><span class="c">)</span>
<span class="pc">#if</span><span class="c">def</span> <span class="w">CONFIG_SERIAL_BFIN_UART0</span>
<span class="pc">s</span><span class="c">tatic</span> <span class="pc">s</span><span class="c">truct</span> <span class="w">r</span><span class="c">esource</span> <span class="w">bfin_uart0_resources</span><span class="c">[] = {</span>
	<span class="pc">{</span>
		<span class="c">.</span><span class="w">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">UART0_THR</span><span class="c">,</span>
		<span class="c">.</span><span class="w">e</span><span class="c">nd</span> <span class="c">=</span> <span class="w">UART0_GCTL+</span><span class="pc">2</span><span class="c">,</span>
		<span class="c">.flags</span> <span class="c">=</span> <span class="w">I</span><span class="pc">ORESOURCE_M</span><span class="c">EM,</span>
	<span class="pc">},</span>
	<span class="c">{</span>
		<span class="c">.</span><span class="w">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">IRQ_UART0_TX</span><span class="c">,</span>
		<span class="c">.</span><span class="pc">e</span><span class="c">nd</span> <span class="c">=</span> <span class="pc">I</span><span class="c">RQ_UART0_TX,</span>
		<span class="c">.</span><span class="pc">f</span><span class="c">lags</span> <span class="c">=</span> <span class="w">I</span><span class="pc">O</span><span class="c">RESOURCE_IRQ,</span>
	<span class="pc">}</span><span class="c">,</span>
	<span class="c">{</span>
		<span class="c">.</span><span class="pc">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">IRQ_UART0_RX</span><span class="c">,</span>
		<span class="c">.</span><span class="pc">e</span><span class="c">nd</span> <span class="c">=</span> <span class="pc">I</span><span class="c">RQ_UART0_RX,</span>
		<span class="c">.flags</span> <span class="c">=</span> <span class="pc">IO</span><span class="c">RESOURCE_IRQ,</span>
	<span class="c">},</span>
	<span class="c">{</span>
		<span class="c">.</span><span class="pc">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">IRQ_UART0_ERROR</span><span class="c">,</span>
		<span class="c">.</span><span class="pc">e</span><span class="c">nd</span> <span class="c">=</span> <span class="c">IRQ_UART0_ERROR,</span>
		<span class="c">.flags</span> <span class="c">=</span> <span class="pc">IO</span><span class="c">RESOURCE_IRQ,</span>
	<span class="c">},</span>
	<span class="c">{</span>
		<span class="c">.</span><span class="pc">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">CH_UART0_TX</span><span class="c">,</span>
		<span class="c">.</span><span class="pc">e</span><span class="c">nd</span> <span class="c">=</span> <span class="c">CH_UART0_TX,</span>
		<span class="c">.flags</span> <span class="c">=</span> <span class="w">IORESOURCE_DMA</span><span class="c">,</span>
	<span class="pc">}</span><span class="c">,</span>
	<span class="c">{</span>
		<span class="c">.</span><span class="pc">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">CH_UART0_RX</span><span class="c">,</span>
		<span class="c">.</span><span class="pc">e</span><span class="c">nd</span> <span class="c">=</span> <span class="c">CH_UART0_RX,</span>
		<span class="c">.flags</span> <span class="c">=</span> <span class="w">I</span><span class="pc">ORESOURCE_D</span><span class="c">MA,</span>
	<span class="c">},</span>
<span class="pc">}</span><span class="c">;</span>

<span class="c">static</span> <span class="pc">u</span><span class="c">nsigned</span> <span class="pc">s</span><span class="c">hort</span> <span class="w">bfin_uart0_peripherals</span><span class="pc">[]</span><span class="c"> = {</span>
	<span class="w">P_UART0_TX</span><span class="c">,</span> <span class="w">P_UART0_RX</span><span class="c">,</span> <span class="w">0</span>
<span class="pc">}</span><span class="c">;</span>

<span class="c">static</span> <span class="c">struct</span> <span class="c">platform_device</span> <span class="w">bfin_uart0_device</span> <span class="pc">=</span><span class="c"> {</span>
	<span class="c">.name</span> <span class="c">= "</span><span class="w">bfin</span><span class="pc">-</span><span class="w">u</span><span class="pc">a</span><span class="c">rt</span><span class="pc">"</span><span class="c">,</span>
	<span class="c">.</span><span class="w">i</span><span class="pc">d</span> <span class="c">=</span> <span class="c">0,</span>
	<span class="c">.</span><span class="w">n</span><span class="pc">u</span><span class="c">m_resources</span> <span class="c">=</span> <span class="pc">A</span><span class="c">RRAY_SIZE(</span><span class="w">bfin_uart0_resources</span><span class="c">),</span>
	<span class="pc">.</span><span class="w">res</span><span class="pc">ource</span> <span class="c">=</span> <span class="c">bfin_uart0_resources,</span>
	<span class="pc">.</span><span class="w">dev</span> <span class="pc">= {</span>
		<span class="c">.</span><span class="w">p</span><span class="pc">l</span><span class="c">atform_data</span> <span class="c">= &amp;</span><span class="w">bfin_uart0_peripherals</span><span class="c">,</span> 
	<span class="pc">}</span><span class="c">,</span>
<span class="c">};</span>
<span class="w">#</span><span class="pc">e</span><span class="c">ndif</span>
<span class="pc">#</span><span class="c">ifdef</span> <span class="w">CONFIG_SERIAL_BFIN_UART1</span>
<span class="c">static</span> <span class="c">struct</span> <span class="w">r</span><span class="c">esource</span> <span class="w">bfin_uart1_resources</span><span class="c">[] = {</span>
	<span class="c">{</span>
		<span class="c">.</span><span class="w">s</span><span class="c">tart</span> <span class="pc">=</span> <span class="w">UART1_THR</span><span class="c">,</span>
		<span class="c">.</span><span class="w">e</span><span class="c">nd</span> <span class="c">=</span> <span class="w">UART1_GCTL</span><span class="pc">+2</span><span class="c">,</span>
		<span class="c">.flags</span> <span class="c">=</span> <span class="w">I</span><span class="pc">ORESOURCE_M</span><span class="c">EM,</span>
	<span class="pc">},</span>
	<span class="pc">{</span>
		<span class="c">.</span><span class="w">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">IRQ_UART1_TX</span><span class="c">,</span>
		<span class="c">.</span><span class="pc">e</span><span class="c">nd</span> <span class="c">=</span> <span class="pc">I</span><span class="c">RQ_UART1_TX,</span>
		<span class="c">.</span><span class="pc">f</span><span class="c">lags</span> <span class="c">=</span> <span class="w">I</span><span class="pc">O</span><span class="c">RESOURCE_IRQ,</span>
	<span class="pc">}</span><span class="c">,</span>
	<span class="c">{</span>
		<span class="c">.</span><span class="pc">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">IRQ_UART1_RX</span><span class="c">,</span>
		<span class="c">.</span><span class="pc">e</span><span class="c">nd</span> <span class="c">=</span> <span class="pc">I</span><span class="c">RQ_UART1_RX,</span>
		<span class="c">.flags</span> <span class="c">=</span> <span class="pc">IO</span><span class="c">RESOURCE_IRQ,</span>
	<span class="c">},</span>
	<span class="c">{</span>
		<span class="c">.</span><span class="pc">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">IRQ_UART1_ERROR</span><span class="c">,</span>
		<span class="c">.</span><span class="pc">e</span><span class="c">nd</span> <span class="c">=</span> <span class="c">IRQ_UART1_ERROR,</span>
		<span class="c">.flags</span> <span class="c">=</span> <span class="pc">IO</span><span class="c">RESOURCE_IRQ,</span>
	<span class="c">},</span>
	<span class="c">{</span>
		<span class="c">.</span><span class="pc">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">CH_UART1_TX</span><span class="c">,</span>
		<span class="c">.</span><span class="pc">e</span><span class="c">nd</span> <span class="c">=</span> <span class="c">CH_UART1_TX,</span>
		<span class="c">.flags</span> <span class="c">=</span> <span class="w">IORESOURCE_DMA</span><span class="c">,</span>
	<span class="pc">}</span><span class="c">,</span>
	<span class="c">{</span>
		<span class="c">.</span><span class="pc">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">CH_UART1_RX</span><span class="c">,</span>
		<span class="c">.</span><span class="pc">e</span><span class="c">nd</span> <span class="c">=</span> <span class="c">CH_UART1_RX,</span>
		<span class="c">.flags</span> <span class="c">=</span> <span class="w">I</span><span class="pc">ORESOURCE_D</span><span class="c">MA,</span>
	<span class="c">},</span>
<span class="w">#</span><span class="pc">i</span><span class="c">fdef</span> <span class="w">CONFIG_BFIN_UART1_CTSRTS</span>
	<span class="w">{</span>	
		<span class="c">.</span><span class="pc">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">GPIO_PF9</span><span class="c">,</span>
		<span class="c">.</span><span class="w">e</span><span class="c">nd</span> <span class="c">=</span> <span class="c">GPIO_PF9,</span>
		<span class="c">.flags</span> <span class="c">=</span> <span class="w">IORESOURCE_IO</span><span class="c">,</span>
	<span class="pc">}</span><span class="c">,</span>
	<span class="pc">{</span>	
		<span class="c">.</span><span class="w">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">GPIO_PF10</span><span class="c">,</span>
		<span class="c">.</span><span class="pc">e</span><span class="c">nd</span> <span class="c">=</span> <span class="pc">G</span><span class="c">PIO_PF10,</span>
		<span class="c">.flags</span> <span class="c">=</span> <span class="w">I</span><span class="pc">ORESOURCE_IO</span><span class="c">,</span>
	<span class="pc">}</span><span class="c">,</span>
<span class="pc">#e</span><span class="c">ndif</span>
<span class="pc">};</span>

<span class="c">static</span> <span class="w">u</span><span class="c">nsigned</span> <span class="pc">s</span><span class="c">hort</span> <span class="w">bfin_uart1_peripherals</span><span class="pc">[]</span><span class="c"> = {</span>
	<span class="w">P_UART1_TX</span><span class="c">,</span> <span class="w">P_UART1_RX</span><span class="c">,</span> <span class="pc">0</span>
<span class="pc">}</span><span class="c">;</span>

<span class="c">static</span> <span class="c">struct</span> <span class="c">platform_device</span> <span class="w">bfin_uart1_device</span> <span class="pc">=</span><span class="c"> {</span>
	<span class="c">.</span><span class="pc">n</span><span class="c">ame</span> <span class="c">= "</span><span class="w">bfin</span><span class="pc">-</span><span class="w">u</span><span class="pc">a</span><span class="c">rt</span><span class="pc">"</span><span class="c">,</span>
	<span class="c">.</span><span class="pc">id</span> <span class="c">=</span> <span class="c">1,</span>
	<span class="c">.</span><span class="w">n</span><span class="pc">u</span><span class="c">m_resources</span> <span class="c">=</span> <span class="pc">A</span><span class="c">RRAY_SIZE(</span><span class="w">bfin_uart1_resources</span><span class="c">),</span>
	<span class="pc">.</span><span class="w">res</span><span class="pc">ource</span> <span class="c">=</span> <span class="c">bfin_uart1_resources,</span>
	<span class="pc">.</span><span class="w">dev</span> <span class="pc">= {</span>
		<span class="c">.</span><span class="w">p</span><span class="pc">l</span><span class="c">atform_data</span> <span class="c">= &amp;</span><span class="w">bfin_uart1_peripherals</span><span class="c">,</span> 
	<span class="pc">}</span><span class="c">,</span>
<span class="pc">}</span><span class="c">;</span>
<span class="w">#</span><span class="pc">e</span><span class="c">ndif</span>
<span class="pc">#</span><span class="w">e</span><span class="c">ndif</span>

<span class="c">#</span><span class="pc">if</span> <span class="c">IS_ENABLED(</span><span class="w">CONFIG_BFIN_SIR</span><span class="c">)</span>
<span class="pc">#if</span><span class="c">def</span> <span class="w">CONFIG_BFIN_SIR0</span>
<span class="pc">s</span><span class="c">tatic</span> <span class="pc">s</span><span class="c">truct</span> <span class="pc">r</span><span class="c">esource</span> <span class="w">bfin_sir0_resources</span><span class="c">[] = {</span>
	<span class="pc">{</span>
		<span class="c">.</span><span class="pc">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">0xFFC00400</span><span class="c">,</span>
		<span class="c">.</span><span class="w">e</span><span class="c">nd</span> <span class="c">=</span> <span class="w">0xFFC004FF</span><span class="c">,</span>
		<span class="c">.flags</span> <span class="c">=</span> <span class="w">I</span><span class="pc">ORESOURCE_M</span><span class="c">EM,</span>
	<span class="pc">}</span><span class="c">,</span>
	<span class="pc">{</span>
		<span class="c">.</span><span class="w">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">IRQ_UART0_RX</span><span class="c">,</span>
		<span class="c">.</span><span class="w">e</span><span class="c">nd</span> <span class="c">=</span> <span class="pc">I</span><span class="c">RQ_UART0_RX</span><span class="w">+</span><span class="c">1,</span>
		<span class="c">.flags</span> <span class="c">=</span> <span class="w">I</span><span class="c">ORESOURCE_IRQ,</span>
	<span class="c">},</span>
	<span class="c">{</span>
		<span class="c">.</span><span class="pc">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">CH_UART0_RX</span><span class="c">,</span>
		<span class="c">.</span><span class="pc">e</span><span class="c">nd</span> <span class="c">=</span> <span class="pc">C</span><span class="c">H_UART0_RX</span><span class="w">+</span><span class="c">1,</span>
		<span class="c">.flags</span> <span class="c">=</span> <span class="w">IORESOURCE_DMA</span><span class="c">,</span>
	<span class="pc">}</span><span class="c">,</span>
<span class="pc">}</span><span class="c">;</span>

<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="w">p</span><span class="c">latform_device</span> <span class="w">bfin_sir0_device</span> <span class="pc">=</span><span class="c"> {</span>
	<span class="c">.name</span> <span class="c">= "</span><span class="w">bfin_sir</span><span class="c">",</span>
	<span class="c">.</span><span class="pc">i</span><span class="c">d</span> <span class="c">=</span> <span class="w">0</span><span class="c">,</span>
	<span class="c">.</span><span class="w">n</span><span class="pc">um_r</span><span class="c">esources</span> <span class="c">=</span> <span class="pc">A</span><span class="c">RRAY_SIZE(</span><span class="w">bfin_sir0_resources</span><span class="c">),</span>
	<span class="pc">.</span><span class="w">res</span><span class="pc">ource</span> <span class="c">=</span> <span class="pc">b</span><span class="c">fin_sir0_resources,</span>
<span class="c">};</span>
<span class="pc">#e</span><span class="c">ndif</span>
<span class="pc">#</span><span class="c">ifdef</span> <span class="w">CONFIG_BFIN_SIR1</span>
<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="pc">r</span><span class="c">esource</span> <span class="w">bfin_sir1_resources</span><span class="c">[] = {</span>
	<span class="c">{</span>
		<span class="c">.</span><span class="pc">s</span><span class="c">tart</span> <span class="pc">=</span> <span class="w">0xFFC02000</span><span class="c">,</span>
		<span class="c">.</span><span class="w">e</span><span class="c">nd</span> <span class="c">=</span> <span class="w">0xFFC020FF</span><span class="c">,</span>
		<span class="c">.flags</span> <span class="c">=</span> <span class="w">I</span><span class="pc">ORESOURCE_M</span><span class="c">EM,</span>
	<span class="c">},</span>
	<span class="pc">{</span>
		<span class="c">.</span><span class="pc">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">IRQ_UART1_RX</span><span class="c">,</span>
		<span class="c">.</span><span class="w">e</span><span class="c">nd</span> <span class="c">=</span> <span class="pc">I</span><span class="c">RQ_UART1_RX</span><span class="w">+</span><span class="c">1,</span>
		<span class="c">.</span><span class="pc">f</span><span class="c">lags</span> <span class="c">=</span> <span class="w">I</span><span class="c">ORESOURCE_IRQ,</span>
	<span class="c">},</span>
	<span class="c">{</span>
		<span class="c">.</span><span class="pc">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">CH_UART1_RX</span><span class="c">,</span>
		<span class="c">.</span><span class="pc">e</span><span class="c">nd</span> <span class="c">=</span> <span class="pc">C</span><span class="c">H_UART1_RX</span><span class="w">+</span><span class="c">1,</span>
		<span class="c">.flags</span> <span class="c">=</span> <span class="w">IORESOURCE_DMA</span><span class="c">,</span>
	<span class="pc">}</span><span class="c">,</span>
<span class="pc">}</span><span class="c">;</span>

<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="w">p</span><span class="c">latform_device</span> <span class="w">bfin_sir1_device</span> <span class="pc">=</span><span class="c"> {</span>
	<span class="c">.name</span> <span class="c">= "</span><span class="w">bfin_sir</span><span class="c">",</span>
	<span class="c">.</span><span class="pc">i</span><span class="c">d</span> <span class="c">=</span> <span class="c">1,</span>
	<span class="c">.</span><span class="w">n</span><span class="pc">um_r</span><span class="c">esources</span> <span class="c">=</span> <span class="pc">A</span><span class="c">RRAY_SIZE(</span><span class="w">bfin_sir1_resources</span><span class="c">),</span>
	<span class="pc">.</span><span class="w">res</span><span class="pc">ource</span> <span class="c">=</span> <span class="pc">b</span><span class="c">fin_sir1_resources,</span>
<span class="c">};</span>
<span class="pc">#e</span><span class="c">ndif</span>
<span class="pc">#</span><span class="w">e</span><span class="c">ndif</span>

<span class="pc">#</span><span class="w">i</span><span class="pc">f</span> <span class="c">IS_ENABLED(</span><span class="w">CONFIG_TOUCHSCREEN_AD7160</span><span class="c">)</span>
<span class="pc">#in</span><span class="c">clude</span> <span class="c">&lt;linux/</span><span class="w">i</span><span class="pc">np</span><span class="c">ut</span><span class="pc">/</span><span class="w">ad7160</span><span class="c">.h&gt;</span>
<span class="pc">sta</span><span class="c">tic</span> <span class="pc">c</span><span class="c">onst</span> <span class="c">struct</span> <span class="w">ad7160_platform_data</span> <span class="w">bfin_ad7160_ts_info</span> <span class="c">= {</span>
	<span class="c">.</span><span class="w">sensor_x_res</span> <span class="c">=</span> <span class="w">854</span><span class="c">,</span>
	<span class="c">.</span><span class="w">sensor_y_res</span> <span class="c">=</span> <span class="w">480</span><span class="c">,</span>
	<span class="c">.</span><span class="w">pressure</span> <span class="c">=</span> <span class="w">1</span><span class="pc">00</span><span class="c">,</span>
	<span class="c">.</span><span class="w">filter_coef</span> <span class="c">=</span> <span class="w">3</span><span class="c">,</span>
	<span class="c">.</span><span class="w">coord_pref</span> <span class="c">=</span> <span class="w">AD7160_ORIG_TOP_LEFT</span><span class="c">,</span>
	<span class="c">.</span><span class="w">first_touch_window</span> <span class="c">=</span> <span class="w">5</span><span class="c">,</span>
	<span class="c">.</span><span class="w">move_window</span> <span class="c">=</span> <span class="w">3</span><span class="c">,</span>
	<span class="c">.</span><span class="w">event_cabs</span> <span class="c">=</span> <span class="w">AD7160_EMIT_ABS_MT_TRACKING_ID</span> <span class="pc">|</span>
			<span class="w">AD7160_EMIT_ABS_MT_PRESSURE</span> <span class="c">|</span>
			<span class="w">AD7160_TRACKING_ID_ASCENDING</span><span class="pc">,</span>
	<span class="c">.</span><span class="w">finger_act_ctrl</span> <span class="c">=</span> <span class="w">0x6</span><span class="pc">4</span><span class="c">,</span>
	<span class="c">.</span><span class="w">haptic_effect1_ctrl</span> <span class="c">=</span> <span class="w">AD7160_HAPTIC_SLOT_A</span><span class="pc">(</span><span class="w">6</span><span class="pc">0</span><span class="w">)</span><span class="pc"> </span><span class="c">|</span>
				<span class="w">AD7160_HAPTIC_SLOT_A_LVL_HIGH</span> <span class="pc">|</span>
				<span class="w">AD7160_HAPTIC_SLOT_B</span><span class="pc">(</span><span class="w">6</span><span class="pc">0) </span><span class="c">|</span>
				<span class="w">AD7160_HAPTIC_SLOT_B_LVL_LOW</span><span class="c">,</span>

	<span class="c">.</span><span class="w">haptic_effect2_ctrl</span> <span class="c">=</span> <span class="w">AD7160_H</span><span class="pc">APTIC_SLOT_A(</span><span class="w">2</span><span class="pc">0) </span><span class="c">|</span>
				<span class="w">A</span><span class="pc">D7160_HAPTIC_SLOT_A_</span><span class="c">LVL_HIGH</span> <span class="c">|</span>
				<span class="w">A</span><span class="pc">D7160_HAPTIC_SLOT_B</span><span class="w">(8</span><span class="pc">0) </span><span class="c">|</span>
				<span class="w">A</span><span class="pc">D7160_HAPTIC_SLOT_B</span><span class="c">_LVL_LOW</span> <span class="c">|</span>
				<span class="w">AD7160_HAPTIC_SLOT_C(120</span><span class="c">) |</span>
				<span class="w">AD7160_HAPTIC_SLOT_C_LVL_HIGH</span> <span class="c">|</span>
				<span class="w">AD7160_HAPTIC_SLOT_D(3</span><span class="pc">0) </span><span class="c">|</span>
				<span class="w">AD7160_HAPTIC_SLOT_D_LVL_LOW</span><span class="pc">,</span>
<span class="w">}</span><span class="c">;</span>
<span class="pc">#e</span><span class="c">ndif</span>

<span class="pc">#</span><span class="w">i</span><span class="pc">f</span> <span class="pc">I</span><span class="c">S_ENABLED(</span><span class="w">CONFIG_I2C_BLACKFIN_TWI</span><span class="c">)</span>
<span class="c">static</span> <span class="pc">c</span><span class="c">onst</span> <span class="pc">u1</span><span class="c">6</span> <span class="w">bfin_twi0_pins</span><span class="c">[] = {</span><span class="w">P_TWI0_SCL</span><span class="c">,</span> <span class="w">P_TWI0_SDA</span><span class="c">,</span> <span class="pc">0}</span><span class="c">;</span>

<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="w">r</span><span class="c">esource</span> <span class="w">bfin_twi0_resource</span><span class="c">[] = {</span>
	<span class="c">[0] = {</span>
		<span class="c">.</span><span class="w">s</span><span class="pc">t</span><span class="c">art</span> <span class="c">=</span> <span class="w">TWI0_REGBASE</span><span class="c">,</span>
		<span class="c">.</span><span class="w">e</span><span class="pc">nd</span>   <span class="c">=</span> <span class="w">T</span><span class="c">WI0_REGBASE,</span>
		<span class="c">.</span><span class="pc">f</span><span class="c">lags</span> <span class="c">=</span> <span class="w">I</span><span class="pc">ORESOURCE_M</span><span class="c">EM,</span>
	<span class="c">},</span>
	<span class="w">[</span><span class="pc">1</span><span class="c">] = {</span>
		<span class="c">.</span><span class="w">s</span><span class="pc">t</span><span class="c">art</span> <span class="c">=</span> <span class="w">IRQ_TWI</span><span class="c">,</span>
		<span class="c">.</span><span class="w">e</span><span class="c">nd</span>   <span class="c">=</span> <span class="w">I</span><span class="c">RQ_TWI,</span>
		<span class="c">.</span><span class="pc">f</span><span class="c">lags</span> <span class="c">=</span> <span class="w">I</span><span class="pc">O</span><span class="c">RESOURCE_IRQ,</span>
	<span class="c">},</span>
<span class="c">};</span>

<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="pc">p</span><span class="c">latform_device</span> <span class="w">i2c_bfin_twi_device</span> <span class="c">= {</span>
	<span class="c">.name</span> <span class="c">= "</span><span class="w">i</span><span class="pc">2c-</span><span class="w">bfin</span><span class="c">-</span><span class="w">twi</span><span class="c">",</span>
	<span class="c">.</span><span class="w">i</span><span class="c">d</span> <span class="c">=</span> <span class="pc">0</span><span class="c">,</span>
	<span class="c">.</span><span class="w">n</span><span class="pc">u</span><span class="c">m_resources</span> <span class="c">=</span> <span class="pc">A</span><span class="c">RRAY_SIZE(</span><span class="w">bfin_twi0_resource</span><span class="c">),</span>
	<span class="pc">.</span><span class="w">res</span><span class="pc">ource</span> <span class="c">=</span> <span class="pc">b</span><span class="c">fin_twi0_resource,</span>
	<span class="pc">.</span><span class="w">de</span><span class="pc">v</span> <span class="pc">= {</span>
		<span class="c">.</span><span class="w">p</span><span class="pc">l</span><span class="c">atform_data</span> <span class="c">= &amp;</span><span class="w">bfin_twi0_pins</span><span class="c">,</span>
	<span class="pc">}</span><span class="c">,</span>
<span class="c">};</span>
<span class="w">#</span><span class="pc">en</span><span class="c">dif</span>

<span class="pc">s</span><span class="c">tatic</span> <span class="c">struct</span> <span class="w">i2c_board_info</span> <span class="w">_</span><span class="pc">_i</span><span class="c">nitdata</span> <span class="w">bfin_i2c_board_info</span><span class="c">[] = {</span>
<span class="w">#i</span><span class="pc">f</span> <span class="pc">I</span><span class="c">S_ENABLED(</span><span class="w">CONFIG_TOUCHSCREEN_AD7160</span><span class="c">)</span>
	<span class="w">{</span>
		<span class="w">I2C_BOARD_INFO</span><span class="pc">("</span><span class="w">ad7160</span><span class="c">",</span> <span class="w">0x3</span><span class="pc">3</span><span class="w">)</span><span class="pc">,</span>
		<span class="c">.</span><span class="w">i</span><span class="pc">r</span><span class="c">q</span> <span class="c">=</span> <span class="w">IRQ_PH1</span><span class="c">,</span>
		<span class="c">.</span><span class="w">p</span><span class="pc">l</span><span class="c">atform_data</span> <span class="pc">= (v</span><span class="c">oid</span> <span class="pc">*)&amp;</span><span class="w">bfin_ad7160_ts_info</span><span class="pc">,</span>
	<span class="pc">}</span><span class="c">,</span>
<span class="w">#</span><span class="c">endif</span>
<span class="pc">}</span><span class="c">;</span>

<span class="pc">#if</span> <span class="pc">I</span><span class="c">S_ENABLED(</span><span class="w">CONFIG_SERIAL_BFIN_SPORT</span><span class="c">)</span>
<span class="pc">#</span><span class="w">i</span><span class="pc">fd</span><span class="c">ef</span> <span class="w">CONFIG_SERIAL_BFIN_SPORT0_UART</span>
<span class="pc">s</span><span class="c">tatic</span> <span class="pc">s</span><span class="c">truct</span> <span class="w">r</span><span class="c">esource</span> <span class="w">bfin_sport0_uart_resources</span><span class="c">[] = {</span>
	<span class="c">{</span>
		<span class="c">.</span><span class="pc">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">SPORT0_TCR1</span><span class="c">,</span>
		<span class="c">.</span><span class="w">e</span><span class="c">nd</span> <span class="c">=</span> <span class="w">SPORT0_MRCS3+4</span><span class="c">,</span>
		<span class="c">.</span><span class="pc">f</span><span class="c">lags</span> <span class="c">=</span> <span class="w">I</span><span class="pc">ORESOURCE_M</span><span class="c">EM,</span>
	<span class="pc">},</span>
	<span class="c">{</span>
		<span class="c">.</span><span class="w">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">IRQ_SPORT0_RX</span><span class="c">,</span>
		<span class="c">.</span><span class="pc">e</span><span class="c">nd</span> <span class="c">=</span> <span class="c">IRQ_SPORT0_RX</span><span class="pc">+1</span><span class="c">,</span>
		<span class="c">.</span><span class="pc">f</span><span class="c">lags</span> <span class="c">=</span> <span class="w">I</span><span class="pc">O</span><span class="c">RESOURCE_IRQ,</span>
	<span class="c">},</span>
	<span class="c">{</span>
		<span class="c">.</span><span class="pc">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">IRQ_SPORT0_ERROR</span><span class="c">,</span>
		<span class="c">.</span><span class="pc">e</span><span class="c">nd</span> <span class="c">=</span> <span class="c">IRQ_SPORT0_ERROR,</span>
		<span class="c">.</span><span class="pc">f</span><span class="c">lags</span> <span class="c">=</span> <span class="pc">IO</span><span class="c">RESOURCE_IRQ,</span>
	<span class="c">},</span>
<span class="pc">}</span><span class="c">;</span>

<span class="c">static</span> <span class="pc">u</span><span class="c">nsigned</span> <span class="pc">s</span><span class="c">hort</span> <span class="w">bfin_sport0_peripherals</span><span class="pc">[]</span><span class="c"> = {</span>
	<span class="w">P_SPORT0_TFS</span><span class="c">,</span> <span class="w">P_SPORT0_DTPRI</span><span class="c">,</span> <span class="w">P_SPORT0_TSCLK</span><span class="c">,</span> <span class="w">P_SPORT0_RFS</span><span class="c">,</span>
	<span class="w">P_SPORT0_DRPRI</span><span class="c">,</span> <span class="w">P_SPORT0_RSCLK</span><span class="c">,</span> <span class="w">0</span>
<span class="pc">}</span><span class="c">;</span>

<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="pc">p</span><span class="c">latform_device</span> <span class="w">bfin_sport0_uart_device</span> <span class="c">= {</span>
	<span class="c">.name</span> <span class="c">= "</span><span class="w">bfin</span><span class="pc">-</span><span class="w">spo</span><span class="c">rt</span><span class="pc">-</span><span class="w">u</span><span class="pc">a</span><span class="c">rt",</span>
	<span class="c">.</span><span class="pc">i</span><span class="c">d</span> <span class="c">=</span> <span class="pc">0</span><span class="c">,</span>
	<span class="c">.</span><span class="w">n</span><span class="pc">u</span><span class="c">m_resources</span> <span class="c">=</span> <span class="pc">A</span><span class="c">RRAY_SIZE(</span><span class="w">bfin_sport0_uart_resources</span><span class="c">),</span>
	<span class="pc">.</span><span class="w">res</span><span class="pc">ource</span> <span class="c">=</span> <span class="pc">bfin_sport0_uart_r</span><span class="c">esources,</span>
	<span class="pc">.</span><span class="w">de</span><span class="pc">v</span> <span class="pc">= {</span>
		<span class="c">.</span><span class="w">pl</span><span class="c">atform_data</span> <span class="c">= &amp;</span><span class="w">bfin_sport0_peripherals</span><span class="c">,</span> 
	<span class="pc">}</span><span class="c">,</span>
<span class="c">};</span>
<span class="w">#</span><span class="pc">e</span><span class="c">ndif</span>
<span class="pc">#i</span><span class="c">fdef</span> <span class="w">CONFIG_SERIAL_BFIN_SPORT1_UART</span>
<span class="c">static</span> <span class="c">struct</span> <span class="w">r</span><span class="c">esource</span> <span class="w">bfin_sport1_uart_resources</span><span class="c">[] = {</span>
	<span class="c">{</span>
		<span class="c">.</span><span class="w">s</span><span class="c">tart</span> <span class="pc">=</span> <span class="w">SPORT1_TCR1</span><span class="c">,</span>
		<span class="c">.</span><span class="w">e</span><span class="c">nd</span> <span class="c">=</span> <span class="w">SPORT1_MRCS3</span><span class="pc">+</span><span class="w">4</span><span class="c">,</span>
		<span class="c">.flags</span> <span class="c">=</span> <span class="w">I</span><span class="pc">ORESOURCE_M</span><span class="c">EM,</span>
	<span class="pc">},</span>
	<span class="pc">{</span>
		<span class="c">.</span><span class="w">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">IRQ_SPORT1_RX</span><span class="c">,</span>
		<span class="c">.</span><span class="pc">e</span><span class="c">nd</span> <span class="c">=</span> <span class="pc">I</span><span class="c">RQ_SPORT1_RX</span><span class="pc">+1</span><span class="c">,</span>
		<span class="c">.</span><span class="pc">f</span><span class="c">lags</span> <span class="c">=</span> <span class="w">I</span><span class="pc">O</span><span class="c">RESOURCE_IRQ,</span>
	<span class="c">},</span>
	<span class="c">{</span>
		<span class="c">.</span><span class="pc">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">IRQ_SPORT1_ERROR</span><span class="c">,</span>
		<span class="c">.</span><span class="pc">e</span><span class="c">nd</span> <span class="c">=</span> <span class="c">IRQ_SPORT1_ERROR,</span>
		<span class="c">.</span><span class="pc">f</span><span class="c">lags</span> <span class="c">=</span> <span class="pc">IO</span><span class="c">RESOURCE_IRQ,</span>
	<span class="c">},</span>
<span class="pc">}</span><span class="c">;</span>

<span class="c">static</span> <span class="pc">u</span><span class="c">nsigned</span> <span class="pc">s</span><span class="c">hort</span> <span class="w">bfin_sport1_peripherals</span><span class="pc">[]</span><span class="c"> = {</span>
	<span class="w">P_SPORT1_TFS</span><span class="c">,</span> <span class="w">P_SPORT1_DTPRI</span><span class="c">,</span> <span class="w">P_SPORT1_TSCLK</span><span class="c">,</span> <span class="w">P_SPORT1_RFS</span><span class="c">,</span>
	<span class="w">P_SPORT1_DRPRI</span><span class="c">,</span> <span class="w">P_SPORT1_RSCLK</span><span class="c">,</span> <span class="w">0</span>
<span class="pc">}</span><span class="c">;</span>

<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="pc">p</span><span class="c">latform_device</span> <span class="w">bfin_sport1_uart_device</span> <span class="c">= {</span>
	<span class="c">.name</span> <span class="c">= "</span><span class="w">bfin</span><span class="pc">-</span><span class="w">spo</span><span class="c">rt</span><span class="pc">-</span><span class="w">u</span><span class="pc">a</span><span class="c">rt",</span>
	<span class="c">.</span><span class="pc">i</span><span class="c">d</span> <span class="c">=</span> <span class="pc">1</span><span class="c">,</span>
	<span class="c">.</span><span class="w">n</span><span class="pc">u</span><span class="c">m_resources</span> <span class="c">=</span> <span class="pc">A</span><span class="c">RRAY_SIZE(</span><span class="w">bfin_sport1_uart_resources</span><span class="c">),</span>
	<span class="pc">.</span><span class="w">res</span><span class="pc">ource</span> <span class="c">=</span> <span class="pc">bfin_sport1_uart_r</span><span class="c">esources,</span>
	<span class="pc">.</span><span class="w">de</span><span class="pc">v</span> <span class="pc">= {</span>
		<span class="c">.</span><span class="w">p</span><span class="pc">l</span><span class="c">atform_data</span> <span class="c">= &amp;</span><span class="w">bfin_sport1_peripherals</span><span class="c">,</span> 
	<span class="pc">}</span><span class="c">,</span>
<span class="c">};</span>
<span class="w">#</span><span class="pc">e</span><span class="c">ndif</span>
<span class="pc">#</span><span class="w">e</span><span class="c">ndif</span>

<span class="c">#</span><span class="pc">if</span> <span class="pc">I</span><span class="c">S_ENABLED(</span><span class="w">CONFIG_INPUT_BFIN_ROTARY</span><span class="c">)</span>
<span class="pc">#i</span><span class="c">nclude</span> <span class="c">&lt;linux/</span><span class="w">pl</span><span class="pc">atform_da</span><span class="c">ta/</span><span class="w">bfin_rotary</span><span class="c">.h&gt;</span>

<span class="pc">sta</span><span class="c">tic</span> <span class="c">const</span> <span class="w">u</span><span class="pc">1</span><span class="c">6</span> <span class="w">per_cnt</span><span class="c">[] = {</span>
	<span class="w">P_CNT_CUD</span><span class="c">,</span>
	<span class="w">P_CNT_CDG</span><span class="c">,</span>
	<span class="w">P_CNT_CZM</span><span class="c">,</span>
	<span class="pc">0</span>
<span class="pc">}</span><span class="c">;</span>

<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="w">bfin_rotary_platform_data</span> <span class="w">bfin_rotary_data</span> <span class="c">= {</span>
	
	
	<span class="c">.</span><span class="w">rotary_rel_code</span>   <span class="c">=</span> <span class="w">REL_WHEEL</span><span class="c">,</span>
	<span class="c">.</span><span class="w">rotary_button_key</span> <span class="c">=</span> <span class="w">KEY_ENTER</span><span class="c">,</span>
	<span class="c">.</span><span class="w">debounce</span>	   <span class="c">=</span> <span class="w">1</span><span class="pc">0</span><span class="c">,</span>	
	<span class="c">.</span><span class="w">m</span><span class="pc">o</span><span class="c">de</span>		   <span class="c">=</span> <span class="w">ROT_QUAD_ENC</span> <span class="pc">|</span> <span class="w">ROT_DEBE</span><span class="pc">,</span>
	<span class="pc">.</span><span class="w">pm_wakeup</span>	   <span class="c">=</span> <span class="c">1,</span>
	<span class="pc">.</span><span class="w">pin_list</span>	   <span class="c">=</span> <span class="w">per_cnt</span><span class="c">,</span>
<span class="pc">}</span><span class="c">;</span>

<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="w">r</span><span class="pc">e</span><span class="c">source</span> <span class="w">bfin_rotary_resources</span><span class="pc">[</span><span class="c">] = {</span>
	<span class="c">{</span>
		<span class="c">.</span><span class="w">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">CNT_CONFIG</span><span class="c">,</span>
		<span class="c">.</span><span class="w">e</span><span class="c">nd</span>   <span class="c">=</span> <span class="pc">C</span><span class="c">NT_CONFIG</span> <span class="w">+</span> <span class="w">0</span><span class="pc">xff</span><span class="c">,</span>
		<span class="c">.</span><span class="w">f</span><span class="c">lags</span> <span class="c">=</span> <span class="w">I</span><span class="pc">ORESOURCE_M</span><span class="c">EM,</span>
	<span class="pc">},</span>
	<span class="pc">{</span>
		<span class="c">.</span><span class="pc">s</span><span class="c">tart</span> <span class="c">=</span> <span class="w">IRQ_CNT</span><span class="c">,</span>
		<span class="c">.</span><span class="pc">e</span><span class="c">nd</span> <span class="c">=</span> <span class="pc">I</span><span class="c">RQ_CNT,</span>
		<span class="c">.</span><span class="pc">f</span><span class="c">lags</span> <span class="c">=</span> <span class="w">I</span><span class="pc">O</span><span class="c">RESOURCE_IRQ,</span>
	<span class="c">},</span>
<span class="pc">}</span><span class="c">;</span>

<span class="c">static</span> <span class="c">struct</span> <span class="pc">p</span><span class="c">latform_device</span> <span class="w">bfin_rotary_device</span> <span class="pc">=</span><span class="c"> {</span>
	<span class="c">.name</span>		<span class="c">= "</span><span class="w">bfin</span><span class="pc">-</span><span class="w">rotary</span><span class="c">",</span>
	<span class="c">.</span><span class="pc">i</span><span class="c">d</span>		<span class="w">=</span><span class="pc"> -</span><span class="c">1,</span>
	<span class="c">.</span><span class="w">n</span><span class="pc">u</span><span class="c">m_resources</span>	<span class="c">=</span> <span class="pc">A</span><span class="c">RRAY_SIZE(</span><span class="w">bfin_rotary_resources</span><span class="c">),</span>
	<span class="pc">.</span><span class="w">res</span><span class="pc">ource</span>	<span class="c">=</span> <span class="c">bfin_rotary_resources,</span>
	<span class="pc">.</span><span class="w">de</span><span class="pc">v</span>		<span class="pc">= {</span>
		<span class="c">.</span><span class="w">p</span><span class="pc">l</span><span class="c">atform_data</span> <span class="c">= &amp;</span><span class="w">bfin_rotary_data</span><span class="c">,</span>
	<span class="pc">}</span><span class="c">,</span>
<span class="pc">}</span><span class="c">;</span>
<span class="w">#</span><span class="pc">e</span><span class="c">ndif</span>

<span class="pc">s</span><span class="c">tatic</span> <span class="pc">c</span><span class="c">onst</span> <span class="pc">u</span><span class="c">nsigned</span> <span class="pc">i</span><span class="c">nt</span> <span class="w">cclk_vlev_datasheet</span><span class="c">[] = {</span>
	<span class="w">VRPAIR</span><span class="pc">(</span><span class="w">VLEV_100</span><span class="c">,</span> <span class="w">400000000</span><span class="pc">)</span><span class="c">,</span>
	<span class="w">V</span><span class="c">RPAIR(</span><span class="w">VLEV_105</span><span class="c">,</span> <span class="w">426000000</span><span class="c">),</span>
	<span class="c">VRPAIR(</span><span class="w">VLEV_110</span><span class="c">,</span> <span class="w">500000000</span><span class="c">),</span>
	<span class="c">VRPAIR(</span><span class="w">VLEV_115</span><span class="c">,</span> <span class="w">533000000</span><span class="c">),</span>
	<span class="c">VRPAIR(</span><span class="w">VLEV_120</span><span class="c">,</span> <span class="w">600000000</span><span class="c">),</span>
<span class="w">}</span><span class="c">;</span>

<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="w">bfin_dpmc_platform_data</span> <span class="w">bfin_dmpc_vreg_data</span> <span class="c">= {</span>
	<span class="pc">.</span><span class="w">tuple_tab</span> <span class="c">=</span> <span class="w">cclk_vlev_datasheet</span><span class="c">,</span>
	<span class="c">.</span><span class="w">tabsize</span> <span class="c">=</span> <span class="pc">A</span><span class="c">RRAY_SIZE(cclk_vlev_datasheet),</span>
	<span class="pc">.</span><span class="w">vr_settling_time</span> <span class="c">=</span> <span class="w">25</span> <span class="c">,</span>
<span class="pc">}</span><span class="c">;</span>

<span class="c">static</span> <span class="c">struct</span> <span class="w">p</span><span class="pc">latform_de</span><span class="c">vice</span> <span class="w">bfin_dpmc</span> <span class="c">= {</span>
	<span class="c">.name</span> <span class="c">= "</span><span class="w">bfin</span> <span class="w">dpmc</span><span class="c">",</span>
	<span class="c">.</span><span class="w">de</span><span class="pc">v</span> <span class="pc">= {</span>
		<span class="c">.</span><span class="w">p</span><span class="pc">l</span><span class="c">atform_data</span> <span class="c">= &amp;bfin_dmpc_vreg_data,</span>
	<span class="pc">}</span><span class="c">,</span>
<span class="pc">}</span><span class="c">;</span>

<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="pc">p</span><span class="c">latform_device</span> <span class="c">*</span><span class="w">stamp_devices[</span><span class="pc">]</span> <span class="pc">_</span><span class="c">_initdata</span> <span class="c">= {</span>

	<span class="w">&amp;b</span><span class="pc">fin_dp</span><span class="c">mc</span><span class="pc">,</span>

<span class="w">#</span><span class="pc">if</span> <span class="c">IS_ENABLED(</span><span class="w">CONFIG_MTD_NAND_BF5XX</span><span class="c">)</span>
	<span class="w">&amp;bf5xx_nand_device</span><span class="pc">,</span>
<span class="pc">#</span><span class="c">endif</span>

<span class="c">#</span><span class="pc">if</span> <span class="c">IS_ENABLED(</span><span class="w">CONFIG_RTC_DRV_BFIN</span><span class="pc">)</span>
	<span class="w">&amp;rtc_device,</span>
<span class="c">#endif</span>

<span class="c">#</span><span class="pc">if</span> <span class="pc">I</span><span class="c">S_ENABLED(</span><span class="w">CONFIG_USB_MUSB_HDRC</span><span class="pc">)</span>
	<span class="w">&amp;musb_device,</span>
<span class="c">#endif</span>

<span class="c">#</span><span class="pc">if</span> <span class="pc">I</span><span class="c">S_ENABLED(</span><span class="w">CONFIG_BFIN_MAC</span><span class="pc">)</span>
	<span class="w">&amp;bfin_mii_bus,</span>
	<span class="w">&amp;bfin_mac_device</span><span class="pc">,</span>
<span class="pc">#</span><span class="c">endif</span>

<span class="c">#if</span> <span class="pc">I</span><span class="c">S_ENABLED(</span><span class="w">CONFIG_SPI_BFIN5XX</span><span class="c">)</span>
	<span class="w">&amp;bfin_spi0_device</span><span class="pc">,</span>
<span class="c">#endif</span>

<span class="c">#if</span> <span class="pc">I</span><span class="c">S_ENABLED(</span><span class="w">CONFIG_SERIAL_BFIN</span><span class="c">)</span>
<span class="c">#</span><span class="w">i</span><span class="pc">fd</span><span class="c">ef</span> <span class="w">CONFIG_SERIAL_BFIN_UART0</span>
	<span class="w">&amp;bfin_uart0_device</span><span class="pc">,</span>
<span class="c">#endif</span>
<span class="c">#</span><span class="pc">ifd</span><span class="c">ef</span> <span class="w">CONFIG_SERIAL_BFIN_UART1</span>
	<span class="w">&amp;bfin_uart1_device</span><span class="pc">,</span>
<span class="c">#endif</span>
<span class="c">#</span><span class="pc">e</span><span class="c">ndif</span>

<span class="c">#</span><span class="pc">i</span><span class="c">f</span> <span class="pc">I</span><span class="c">S_ENABLED(</span><span class="w">CONFIG_FB_BFIN_RA158Z</span><span class="c">)</span>
	<span class="w">&amp;bf52x_ra158z_device,</span>
<span class="c">#endif</span>

<span class="c">#</span><span class="pc">if</span> <span class="pc">I</span><span class="c">S_ENABLED(</span><span class="w">CONFIG_BFIN_SIR</span><span class="c">)</span>
<span class="c">#</span><span class="pc">i</span><span class="c">fdef</span> <span class="w">CONFIG_BFIN_SIR0</span>
	<span class="w">&amp;bfin_sir0_device</span><span class="pc">,</span>
<span class="c">#endif</span>
<span class="c">#</span><span class="pc">i</span><span class="c">fdef</span> <span class="w">CONFIG_BFIN_SIR1</span>
	<span class="w">&amp;bfin_sir1_device</span><span class="pc">,</span>
<span class="c">#endif</span>
<span class="c">#</span><span class="pc">en</span><span class="c">dif</span>

<span class="c">#</span><span class="pc">if</span> <span class="pc">I</span><span class="c">S_ENABLED(</span><span class="w">CONFIG_I2C_BLACKFIN_TWI</span><span class="c">)</span>
	<span class="w">&amp;i2c_bfin_twi_device,</span>
<span class="c">#endif</span>

<span class="c">#</span><span class="pc">if</span> <span class="pc">I</span><span class="c">S_ENABLED(</span><span class="w">CONFIG_SERIAL_BFIN_SPORT</span><span class="c">)</span>
<span class="c">#</span><span class="pc">i</span><span class="c">fdef</span> <span class="w">CONFIG_SERIAL_BFIN_SPORT0_UART</span>
	<span class="w">&amp;bfin_sport0_uart_device</span><span class="pc">,</span>
<span class="c">#endif</span>
<span class="c">#</span><span class="pc">i</span><span class="c">fdef</span> <span class="w">CONFIG_SERIAL_BFIN_SPORT1_UART</span>
	<span class="w">&amp;bfin_sport1_uart_device</span><span class="pc">,</span>
<span class="c">#endif</span>
<span class="c">#</span><span class="pc">en</span><span class="c">dif</span>

<span class="c">#</span><span class="pc">if</span> <span class="pc">I</span><span class="c">S_ENABLED(</span><span class="w">CONFIG_INPUT_BFIN_ROTARY</span><span class="c">)</span>
	<span class="w">&amp;bfin_rotary_device,</span>
<span class="c">#endif</span>

<span class="c">#</span><span class="pc">if</span> <span class="pc">I</span><span class="c">S_ENABLED(</span><span class="w">CONFIG_MTD_PHYSMAP</span><span class="c">)</span>
	<span class="w">&amp;ad7160eval_flash_device,</span>
<span class="c">#</span><span class="pc">en</span><span class="c">dif</span>

<span class="c">#</span><span class="pc">if</span> <span class="pc">I</span><span class="c">S_ENABLED(</span><span class="w">CONFIG_SND_BF5XX_I2S</span><span class="c">)</span>
	<span class="w">&amp;bfin_i2s</span><span class="pc">,</span>
<span class="c">#endif</span>
<span class="pc">}</span><span class="c">;</span>

<span class="pc">sta</span><span class="c">tic</span> <span class="pc">int</span> <span class="c">__init</span> <span class="w">ad7160eval_init</span><span class="c">(void)</span>
<span class="c">{</span>
	<span class="w">p</span><span class="c">rintk(</span><span class="pc">KERN_I</span><span class="c">NFO</span> <span class="pc">"%</span><span class="c">s</span><span class="w">():</span> <span class="w">registering</span> <span class="pc">d</span><span class="c">evice</span> <span class="w">res</span><span class="pc">ources</span><span class="c">\n",</span> <span class="c">__func__);</span>
	<span class="w">i2c_register_board_info</span><span class="c">(</span><span class="w">0</span><span class="pc">,</span> <span class="w">bfin_i2c_board_info</span><span class="pc">,</span>
				<span class="w">A</span><span class="c">RRAY_SIZE(bfin_i2c_board_info));</span>
	<span class="w">platform_add_devices</span><span class="c">(</span><span class="w">stamp_devices</span><span class="pc">,</span> <span class="w">A</span><span class="c">RRAY_SIZE(stamp_devices));</span>
	<span class="w">spi_register_board_info</span><span class="c">(</span><span class="w">bfin_spi_board_info</span><span class="pc">,</span> <span class="w">A</span><span class="c">RRAY_SIZE(bfin_spi_board_info));</span>
	<span class="pc">r</span><span class="c">eturn</span> <span class="c">0;</span>
<span class="c">}</span>

<span class="w">arch_initcall</span><span class="c">(</span><span class="w">ad7160eval_init</span><span class="pc">)</span><span class="c">;</span>

<span class="c">static</span> <span class="pc">s</span><span class="c">truct</span> <span class="w">p</span><span class="pc">latform_de</span><span class="c">vice</span> <span class="c">*</span><span class="w">ad7160eval_early_devices[</span><span class="pc">]</span> <span class="c">__initdata</span> <span class="c">= {</span>
<span class="pc">#if</span> <span class="c">defined(</span><span class="w">CONFIG_SERIAL_BFIN_CONSOLE</span><span class="pc">) </span><span class="c">||</span> <span class="c">defined(</span><span class="w">CONFIG_EARLY_PRINTK</span><span class="c">)</span>
<span class="c">#</span><span class="pc">if</span><span class="c">def</span> <span class="w">CONFIG_SERIAL_BFIN_UART0</span>
	<span class="w">&amp;bfin_uart0_device,</span>
<span class="w">#</span><span class="c">endif</span>
<span class="c">#</span><span class="pc">i</span><span class="c">fdef</span> <span class="w">CONFIG_SERIAL_BFIN_UART1</span>
	<span class="w">&amp;bfin_uart1_device,</span>
<span class="c">#endif</span>
<span class="c">#</span><span class="pc">en</span><span class="c">dif</span>

<span class="c">#</span><span class="pc">if</span> <span class="c">defined(</span><span class="w">CONFIG_SERIAL_BFIN_SPORT_CONSOLE</span><span class="c">)</span>
<span class="c">#</span><span class="pc">i</span><span class="c">fdef</span> <span class="w">CONFIG_SERIAL_BFIN_SPORT0_UART</span>
	<span class="w">&amp;bfin_sport0_uart_device</span><span class="pc">,</span>
<span class="c">#endif</span>
<span class="c">#</span><span class="pc">i</span><span class="c">fdef</span> <span class="w">CONFIG_SERIAL_BFIN_SPORT1_UART</span>
	<span class="w">&amp;bfin_sport1_uart_device</span><span class="pc">,</span>
<span class="c">#endif</span>
<span class="c">#</span><span class="pc">en</span><span class="c">dif</span>
<span class="pc">}</span><span class="c">;</span>

<span class="w">v</span><span class="c">oid</span> <span class="c">__init</span> <span class="w">native_machine_early_platform_add_devices</span><span class="c">(void</span><span class="pc">)</span>
<span class="c">{</span>
	<span class="pc">p</span><span class="c">rintk(</span><span class="pc">KERN_I</span><span class="c">NFO</span> <span class="c">"</span><span class="w">r</span><span class="pc">egi</span><span class="c">ster</span> <span class="w">early</span> <span class="w">pl</span><span class="c">atform</span> <span class="w">d</span><span class="pc">evices</span><span class="w">\</span><span class="c">n");</span>
	<span class="w">early_platform_add_devices</span><span class="c">(</span><span class="w">ad7160eval_early_devices</span><span class="pc">,</span>
		<span class="w">A</span><span class="c">RRAY_SIZE(ad7160eval_early_devices));</span>
<span class="c">}</span>

<span class="w">v</span><span class="c">oid</span> <span class="w">native_machine_restart</span><span class="c">(</span><span class="w">c</span><span class="pc">h</span><span class="c">ar</span> <span class="c">*</span><span class="w">cm</span><span class="c">d</span><span class="pc">)</span>
<span class="c">{</span>
	
	<span class="pc">if</span> <span class="pc">((</span><span class="w">bfin_read_SYSCR() &amp;</span> <span class="w">0x7</span><span class="pc">)</span><span class="c"> ==</span> <span class="w">0x3</span><span class="pc">)</span>
		<span class="w">bfin_reset_boot_spi_cs</span><span class="c">(</span><span class="w">P_DEFAULT_BOOT_SPI_CS</span><span class="c">);</span>
<span class="pc">}</span>

<span class="w">i</span><span class="pc">n</span><span class="c">t</span> <span class="w">bfin_get_ether_addr</span><span class="c">(</span><span class="w">c</span><span class="pc">h</span><span class="c">ar</span> <span class="c">*</span><span class="w">ad</span><span class="pc">dr)</span>
<span class="c">{</span>
	
	<span class="pc">u3</span><span class="c">2</span> <span class="w">r</span><span class="pc">et</span><span class="c">;</span>
	<span class="w">u</span><span class="pc">6</span><span class="c">4</span> <span class="w">otp_mac</span><span class="c">;</span>
	<span class="pc">u3</span><span class="c">2</span> <span class="w">(</span><span class="pc">*</span><span class="w">otp_read</span><span class="c">)(</span><span class="pc">u3</span><span class="c">2</span> <span class="w">pag</span><span class="pc">e,</span> <span class="c">u32</span> <span class="w">f</span><span class="c">lags</span><span class="pc">,</span> <span class="pc">u6</span><span class="c">4</span> <span class="c">*</span><span class="w">page_content) = (v</span><span class="c">oid</span> <span class="pc">*)</span><span class="w">0xEF00001A</span><span class="pc">;</span>

	<span class="w">r</span><span class="pc">et</span> <span class="c">=</span> <span class="w">o</span><span class="c">tp_read(</span><span class="w">0xDF</span><span class="pc">,</span> <span class="w">0x00</span><span class="pc">, </span><span class="c">&amp;</span><span class="w">o</span><span class="pc">t</span><span class="c">p_mac);</span>
	<span class="c">if</span> <span class="pc">(!(r</span><span class="c">et</span> <span class="pc">&amp;</span> <span class="w">0x1</span><span class="c">)) {</span>
		<span class="w">ch</span><span class="c">ar</span> <span class="c">*</span><span class="w">otp_mac_p</span> <span class="c">= (</span><span class="w">c</span><span class="pc">h</span><span class="c">ar</span> <span class="pc">*)&amp;</span><span class="w">ot</span><span class="pc">p_mac</span><span class="c">;</span>
		<span class="w">f</span><span class="c">or</span> <span class="c">(</span><span class="w">r</span><span class="c">et</span> <span class="c">=</span> <span class="c">0;</span> <span class="w">r</span><span class="c">et</span> <span class="c">&lt;</span> <span class="w">6</span><span class="pc">; </span><span class="c">++</span><span class="w">r</span><span class="c">et</span><span class="pc">)</span>
			<span class="w">a</span><span class="c">ddr</span><span class="pc">[</span><span class="w">r</span><span class="c">et] =</span> <span class="c">otp_mac_p</span><span class="pc">[</span><span class="w">5</span> <span class="pc">-</span> <span class="w">r</span><span class="c">et];</span>
	<span class="pc">}</span>
	<span class="pc">retu</span><span class="c">rn</span> <span class="pc">0</span><span class="c">;</span>
<span class="c">}</span>
<span class="w">E</span><span class="pc">XPORT_SYMBOL</span><span class="c">(</span><span class="w">bfin_get_ether_addr</span><span class="c">);</span>

</pre>
</body>
</html>

